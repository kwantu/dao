(function(f){if(typeof exports==="object"&&typeof module!=="undefined"){module.exports=f()}else if(typeof define==="function"&&define.amd){define([],f)}else{var g;if(typeof window!=="undefined"){g=window}else if(typeof global!=="undefined"){g=global}else if(typeof self!=="undefined"){g=self}else{g=this}g.GK = f()}})(function(){var define,module,exports;return (function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a=typeof require=="function"&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);var f=new Error("Cannot find module '"+o+"'");throw f.code="MODULE_NOT_FOUND",f}var l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){var n=t[o][1][e];return s(n?n:e)},l,l.exports,e,t,n,r)}return n[o].exports}var i=typeof require=="function"&&require;for(var o=0;o<r.length;o++)s(r[o]);return s})({1:[function(require,module,exports){
var globalurl="",masterDB,localDB,taxonomyDB,authenticatedToSyncGateway=!1,dao=function(){return{authenticateToSyncGateway:function(e,t){var n=new $.Deferred,o="http://"+COUCHBASE_DOMAIN+":"+COUCHBASE_PORT+"/"+TAXONOMY_BUCKET+"/_session",r="POST",a=JSON.stringify({name:e,password:t}),c=!0,i=new XMLHttpRequest;i.withCredentials=!0,i.onload=function(){i.status,i.responseText},i.open(r,o,c),i.setRequestHeader("Content-Type","application/json;charset=UTF-8"),i.send(a);var o="http://"+COUCHBASE_DOMAIN+":"+COUCHBASE_PORT+"/"+COUCHBASE_BUCKET+"/_session",r="POST",a=JSON.stringify({name:e,password:t}),c=!0,i=new XMLHttpRequest;return i.withCredentials=!0,i.onload=function(){var e=i.status,t=i.responseText;200==e?(authenticatedToSyncGateway=!0,n.resolve(t)):n.reject(t)},i.open(r,o,c),i.setRequestHeader("Content-Type","application/json;charset=UTF-8"),i.send(a),n.promise()},get:function(e){var t=new $.Deferred;try{head.mobile&&isCordovaApp?cordova.exec(function(e){t.resolve(e)},function(e){t.reject(e)},"CBLite","getDocument",[{dbname:DBNAME+DB_IDENTIFIER,docId:e}]):localDB.get(e).then(function(e){t.resolve(e)})["catch"](function(n){return console.log("Desktop - error in getting document with id: "+e+". Error stacktrace: "+n),t.reject(n),n})}catch(n){t.reject(n)}return t.promise()},getTaxonomy:function(e){var t=new $.Deferred;return head.mobile&&isCordovaApp?cordova.exec(function(e){t.resolve(e)},function(e){t.reject(e)},"CBLite","getDocument",[{dbname:TAXONOMY_DBNAME+DB_IDENTIFIER,docId:e}]):taxonomyDB.get(e).then(function(e){t.resolve(e)})["catch"](function(n){return console.log("Desktop - error in getting taxonomy with id: "+e+". Error stacktrace: "+n),t.reject(n),n}),t.promise()},save:function(e){var t=new $.Deferred;if(head.mobile&&isCordovaApp)if(0!=e._id.indexOf("_design"))cordova.exec(function(e){t.resolve(e)},function(e){t.reject(e)},"CBLite","saveDocument",[{dbname:DBNAME+DB_IDENTIFIER,docId:e._id,doc:e}]);else{var n={url:globalurl+DBNAME+DB_IDENTIFIER+"/"+e._id,type:"PUT",data:JSON.stringify(e),dataType:"json",contentType:"application/json"};$.ajax(n).done(function(e,n,o){t.resolve(e)}).fail(function(n,o,r){console.log("Mobile - error in saving document with id: "+e._id+". URL: "+globalurl+DBNAME+DB_IDENTIFIER+" Error stacktrace: "+JSON.stringify(n)),t.reject(n.responseText)})}else localDB.put(e).then(function(e){t.resolve(e)})["catch"](function(n){console.log("Desktop - error in saving document with id: "+e._id+". Error stacktrace: "+n),t.reject(n)});return t.promise()},saveAttachment:function(e,t,n,o,r){var a=new $.Deferred;return head.mobile&&isCordovaApp?blobUtil.base64StringToBlob(n,o).then(function(n){var o=new XMLHttpRequest;o.open("PUT",globalurl+DBNAME+DB_IDENTIFIER+"/"+e+"/"+r+"?rev="+t,!0),o.onload=function(e){a.resolve(JSON.parse(o.responseText))},o.send(n)})["catch"](function(e){console.log(e),a.reject(xhr.responseText)}):localDB.putAttachment(e,r,t,n,o).then(function(e){a.resolve(e)})["catch"](function(t){console.log("Desktop -error in saving attachment to the document with id: "+e+". Error stacktrace: "+t),a.reject(t)}),a.promise()},getAttachment:function(e,t,n){var o=new $.Deferred;if(head.mobile&&isCordovaApp){var r=new XMLHttpRequest;r.open("GET",globalurl+DBNAME+DB_IDENTIFIER+"/"+e+"/"+n,!0),r.responseType="blob",r.onload=function(t){if(200==this.status){var n=r.response;blobUtil.blobToBase64String(n).then(function(e){o.resolve(e)})["catch"](function(t){console.log("Mobile - error in getting attachment to the document with id: "+e+". Error stacktrace: "+t),o.reject(r)})}else console.log("Mobile - error in getting attachment to the document with id: "+e),o.reject(r)},r.send()}else localDB.getAttachment(e,n).then(function(e){blobUtil.blobToBase64String(e).then(function(e){o.resolve(e)})["catch"](function(e){o.reject(e)})})["catch"](function(t){console.log("Desktop -error in getting attachment to the document with id: "+e+". Error stacktrace: "+t),o.reject(t)});return o.promise()},deleteAttachment:function(e,t,n){var o=new $.Deferred;if(head.mobile&&isCordovaApp){var r={url:globalurl+DBNAME+DB_IDENTIFIER+"/"+e+"/"+n+"?rev="+t,type:"DELETE",dataType:"json"};$.ajax(r).done(function(e,t,n){o.resolve(e)}).fail(function(t,n,r){console.log("Mobile - error in deleting attachment to the document with id: "+e+". Error stacktrace: "+JSON.stringify(t)),o.reject(t.responseText)})}else localDB.removeAttachment(e,n,t).then(function(e){o.resolve(e)})["catch"](function(t){console.log("Desktop - error in deleting attachment to the document with id: "+e+". Error stacktrace: "+JSON.stringify(xhr)),o.reject(t)});return o.promise()},upsert:function(e){var t=new $.Deferred,n=function(n){e._rev=n._rev,dao.save(e).done(function(e){t.resolve(e)}).fail(function(e){t.reject(e)})},o=function(n){dao.save(e).done(function(e){console.log(e),t.resolve(e)}).fail(function(e){t.reject(e)})};return dao.get(e._id).done(n).fail(o),t.promise()},startPull:function(){var e=new $.Deferred,t=LOCAL_SETTINGS.SUBSCRIPTIONS.syncUsername,n=LOCAL_SETTINGS.SUBSCRIPTIONS.syncPassword;return head.mobile&&isCordovaApp?cordova.exec(function(t){SYNC_SEQ=t,e.resolve(t)},function(t){e.reject(t)},"CBLite","pull",[{dbname:DBNAME+DB_IDENTIFIER,url:"http://"+t+":"+n+"@"+COUCHBASE_DOMAIN+":"+COUCHBASE_PORT+"/"+COUCHBASE_BUCKET}]):0==authenticatedToSyncGateway?dao.authenticateToSyncGateway(t,n).done(function(t){localDB.replicate.from(new PouchDB("http://"+COUCHBASE_DOMAIN+":"+COUCHBASE_PORT+"/"+COUCHBASE_BUCKET,{ajax:{timeout:6e4}}),{live:!1,retry:!0,timeout:6e4}).then(function(t){e.resolve("")})["catch"](function(t){e.reject(t)})}).fail(function(t){e.reject(t)}):localDB.replicate.from(new PouchDB("http://"+COUCHBASE_DOMAIN+":"+COUCHBASE_PORT+"/"+COUCHBASE_BUCKET,{ajax:{timeout:6e4}}),{live:!1,retry:!0,timeout:6e4}).then(function(t){e.resolve("")})["catch"](function(t){e.reject(t)}),e.promise()},pullTaxonomies:function(){var e=new $.Deferred,t=LOCAL_SETTINGS.SUBSCRIPTIONS.syncUsername,n=LOCAL_SETTINGS.SUBSCRIPTIONS.syncPassword;return head.mobile&&isCordovaApp?cordova.exec(function(t){e.resolve(t)},function(t){e.reject(t)},"CBLite","pull",[{dbname:TAXONOMY_DBNAME+DB_IDENTIFIER,url:"http://"+t+":"+n+"@"+COUCHBASE_DOMAIN+":"+COUCHBASE_PORT+"/"+TAXONOMY_BUCKET}]):0==authenticatedToSyncGateway?dao.authenticateToSyncGateway(t,n).done(function(t){taxonomyDB.replicate.from(new PouchDB("http://"+COUCHBASE_DOMAIN+":"+COUCHBASE_PORT+"/"+TAXONOMY_BUCKET,{ajax:{timeout:6e4}}),{live:!1,retry:!0,timeout:6e4}).then(function(t){e.resolve("")})["catch"](function(t){e.reject(t)})}).fail(function(t){e.reject(t)}):taxonomyDB.replicate.from(new PouchDB("http://"+COUCHBASE_DOMAIN+":"+COUCHBASE_PORT+"/"+TAXONOMY_BUCKET,{ajax:{timeout:6e4}}),{live:!1,retry:!0,timeout:6e4}).then(function(t){e.resolve("")})["catch"](function(t){e.reject(t)}),e.promise()},startSync:function(){var e=new $.Deferred;return dao.get("_local/LOCAL_SETTINGS").then(function(t){var n=LOCAL_SETTINGS.SUBSCRIPTIONS.syncUsername,o=LOCAL_SETTINGS.SUBSCRIPTIONS.syncPassword;head.mobile&&isCordovaApp?cordova.exec(function(t){SYNC_SEQ=t,e.resolve(t)},function(t){e.reject(t)},"CBLite","sync",[{dbname:DBNAME+DB_IDENTIFIER,url:"http://"+n+":"+o+"@"+COUCHBASE_DOMAIN+":"+COUCHBASE_PORT+"/"+COUCHBASE_BUCKET}]):0==authenticatedToSyncGateway?dao.authenticateToSyncGateway(n,o).done(function(t){localDB.sync(new PouchDB("http://"+COUCHBASE_DOMAIN+":"+COUCHBASE_PORT+"/"+COUCHBASE_BUCKET,{ajax:{timeout:6e4}}),{live:!0,retry:!0,timeout:6e4}).on("change",function(n){SYNC_SEQ=""+n.change.last_seq,e.resolve(t)}).on("active",function(){}).on("complete",function(e){}).on("error",function(t){e.reject(t)})}).fail(function(t){e.reject(t)}):localDB.sync(new PouchDB("http://"+COUCHBASE_DOMAIN+":"+COUCHBASE_PORT+"/"+COUCHBASE_BUCKET,{ajax:{timeout:6e4}}),{live:!0,retry:!0,timeout:6e4}).on("change",function(n){SYNC_SEQ=""+n.change.last_seq,e.resolve(t)}).on("active",function(){}).on("complete",function(e){}).on("error",function(t){e.reject(t)})}).fail(function(t){e.reject(t)}),e.promise()},startSyncTaxonomies:function(){return dao.pullTaxonomies()},changes:function(){var e=new $.Deferred;return head.mobile&&isCordovaApp?$.ajax({url:globalurl+DBNAME+DB_IDENTIFIER+"/_changes?since="+LOCAL_SETTINGS.SYNC_SEQ,type:"GET",dataType:"json",success:function(t,n,o){e.resolve(t)},error:function(t,n,o){console.log("Error = "+JSON.stringify(t)),e.reject(t.responseText)}}):localDB.changes({since:parseInt(LOCAL_SETTINGS.SYNC_SEQ)}).then(function(t){e.resolve(t)})["catch"](function(t){e.reject(t)}),e.promise()},createDatabase:function(){var e=new $.Deferred;return head.mobile&&isCordovaApp?window.cblite?window.cblite.getURL(function(t,n){if(t)alert("error launching Couchbase Lite: "+t);else{globalurl=n;try{var o=new XMLHttpRequest;o.open("GET",globalurl,!1),o.send(null)}catch(r){}$.ajax({url:globalurl+DBNAME+"master",type:"PUT",data:"",dataType:"json",contentType:"application/json",success:function(t,n,o){201==o.status||412==o.status?dao.getIdentifier().done(function(t){DB_IDENTIFIER=t,dao.createDatabaseImpl(e)}).fail(function(t){DB_IDENTIFIER=generateUUID().substring(0,8),dao.saveIdentifier().done(function(t){dao.createDatabaseImpl(e)})}):e.reject(o.responseText)},error:function(t,n,o){201==t.status||412==t.status?dao.getIdentifier().done(function(t){DB_IDENTIFIER=t,dao.createDatabaseImpl(e)}).fail(function(t){DB_IDENTIFIER=generateUUID().substring(0,8),dao.saveIdentifier().done(function(t){dao.createDatabaseImpl(e)})}):e.reject(t.responseText)}})}}):alert("error, Couchbase Lite plugin not found."):new PouchDB(DBNAME+"master").then(function(t){masterDB=t,dao.getIdentifier().done(function(t){DB_IDENTIFIER=t,dao.createDatabaseImpl(e)}).fail(function(t){DB_IDENTIFIER=generateUUID().substring(0,8),dao.saveIdentifier().done(function(t){dao.createDatabaseImpl(e)})})}),e.promise()},createDatabaseImpl:function(e){head.mobile&&isCordovaApp?($.ajax({url:globalurl+TAXONOMY_DBNAME+DB_IDENTIFIER,type:"PUT",data:"",dataType:"json",contentType:"application/json",success:function(e,t,n){},error:function(e,t,n){}}),$.ajax({url:globalurl+DBNAME+DB_IDENTIFIER,type:"PUT",data:"",dataType:"json",contentType:"application/json",success:function(t,n,o){201==o.status||412==o.status?e.resolve(t):e.reject(o.responseText)},error:function(t,n,o){201==t.status||412==t.status?e.resolve(t.responseText):e.reject(t.responseText)}})):new PouchDB(TAXONOMY_DBNAME+DB_IDENTIFIER).then(function(t){taxonomyDB=t,new PouchDB(DBNAME+DB_IDENTIFIER).then(function(t){localDB=t,e.resolve("Database created")})})},deleteDocument:function(e){var t=new $.Deferred;if(head.mobile&&isCordovaApp){var n=function(e){$.ajax({url:globalurl+DBNAME+DB_IDENTIFIER+"/"+e._id+"?rev="+e._rev,type:"DELETE",data:JSON.stringify(e),dataType:"json",contentType:"application/json",success:function(e,n,o){t.resolve(e)},error:function(e,n,o){t.reject(e.responseText)}})};dao.get(e).done(n).fail(function(e){t.reject(e)})}else localDB.get(e).then(function(e){return localDB.remove(e)}).then(function(e){t.resolve(e)})["catch"](function(e){t.reject(e)});return t.promise()},resetDatabase:function(){var e=new $.Deferred,t=DB_IDENTIFIER;return DB_IDENTIFIER=generateUUID().substring(0,8),dao.saveIdentifier().done(function(n){head.mobile&&isCordovaApp?$.ajax({url:globalurl+TAXONOMY_DBNAME+t,type:"DELETE",success:function(n,o,r){$.ajax({url:globalurl+DBNAME+t,type:"DELETE",success:function(t,n,o){dao.createDatabase().done(new function(n){e.resolve(t)}).fail(function(t){e.resolve(t)})},error:function(t,n,o){e.resolve(t.responseText)}})},error:function(t,n,o){e.resolve(t.responseText)}}):taxonomyDB.destroy().then(function(t){localDB.destroy().then(function(t){dao.createDatabase().done(new function(t){e.resolve(t)}).fail(function(t){e.reject(t)})})["catch"](function(t){e.reject(t)})})["catch"](function(t){e.reject(t)})}),e.promise()},createDocView:function(e,t){var n=new $.Deferred;return t._id="_design/"+e,dao.upsert(t).done(function(e){n.resolve(e)}).fail(function(e){n.reject(e)}),n.promise()},getIdentifier:function(){var e=new $.Deferred;try{if(head.mobile&&isCordovaApp){var t={url:globalurl+DBNAME+"master/_local/SETTINGS",type:"GET",dataType:"json"};$.ajax(t).done(function(t,n,o){e.resolve(t.DB_IDENTIFIER)}).fail(function(t,n,o){e.reject(t)})}else masterDB.get("_local/SETTINGS").then(function(t){e.resolve(t.DB_IDENTIFIER)})["catch"](function(t){return e.reject(t),t})}catch(n){e.reject(n)}return e.promise()},saveIdentifier:function(){var e={DB_IDENTIFIER:DB_IDENTIFIER,_id:"_local/SETTINGS"},t=new $.Deferred,n=function(e){if(head.mobile&&isCordovaApp){var n={url:globalurl+DBNAME+"master/_local/SETTINGS",type:"PUT",data:JSON.stringify(e),dataType:"json",contentType:"application/json"};$.ajax(n).done(function(e,n,o){t.resolve(e)}).fail(function(e,n,o){t.reject(e.responseText)})}else masterDB.put(e).then(function(e){t.resolve(e)})["catch"](function(e){t.reject(e)})},o=function(t){e._rev=t._rev,n(e)},r=function(t){n(e)};if(head.mobile&&isCordovaApp){var a={url:globalurl+DBNAME+"master/_local/SETTINGS",type:"GET",dataType:"json"};$.ajax(a).done(o).fail(r)}else masterDB.get("_local/SETTINGS").then(o)["catch"](r);return t.promise()},getDocView:function(e,t,n){var o=new $.Deferred;try{var r=!1;if(void 0!=n&&void 0!=n.descending&&(r=n.descending),head.mobile&&isCordovaApp){var a="?include_docs=true&key="+n.key+"&limit="+n.pageSizeVal+"&size="+n.pageIndexVal*n.pageSizeVal+"&descending="+r;$.ajax({url:globalurl+DBNAME+DB_IDENTIFIER+"/_design/"+e+"/_view/"+t+a,type:"GET",dataType:"json",success:function(e,t,n){o.resolve(e)},error:function(e,t,n){console.log("error occured while getting doc view "+JSON.stringify(e)),o.reject(e.responseText)}})}else localDB.query(e+"/"+t,{include_docs:!0,key:n.key,limit:n.pageSizeVal,skip:n.pageIndexVal*n.pageSizeVal,descending:r}).then(function(e){o.resolve(e)})["catch"](function(e){console.log(e),o.reject(e)})}catch(c){o.reject(c)}return o.promise()},search:function(e,t){var n=new $.Deferred,o="view_searchData",r=generateUUID(),a={language:"javascript",views:{view_searchData:{map:"function(doc) {var searchableCategories = JSON.parse('"+JSON.stringify(e)+"');if(typeof (doc.title) != 'undefined' && typeof (doc.category) != 'undefined' && typeof (doc.category.term) != 'undefined'){if(searchableCategories.indexOf(doc.category.term) > -1){var docTitle = doc.title.toLowerCase();if( (doc.category.term == 'participant' && doc._id.toLowerCase().indexOf('"+t.toLowerCase()+"') > -1) || docTitle.indexOf('"+t.toLowerCase()+"') > -1) {  var jsonObj = doc; emit(doc.title.toUpperCase(),  jsonObj ); }}}}"}}},c=function(e){setTimeout(function(){var e={pageSizeVal:50,pageIndexVal:0,include_docs:!0};dao.getDocView(r,o,e).done(function(e){n.resolve(e)}).fail(function(e){n.reject(e)})},1e3)};return dao.createDocView(r,a).done(c).fail(function(e){n.reject(e)}),n.promise()},profileData:function(e,t){var n=new $.Deferred,o="view_searchData",r="Search"+e+t,a={pageSizeVal:500,pageIndexVal:0,include_docs:!0};return dao.getDocView(r,o,a).done(function(e){n.resolve(e)}).fail(function(a){var c={language:"javascript",views:{view_searchData:{map:"function(doc) {if(typeof (doc.title) != 'undefined' && typeof (doc.category) != 'undefined' && typeof (doc.category.term) != 'undefined'){if( doc.category.term == '"+e+"' && doc.channels.indexOf('"+t+'\') > -1) {  var jsonObj = {"doc": {  "updated": doc.updated, "_id": doc._id, "title": doc.title, "category": { "term": doc.category.term }, "model": { "pending": { "photos": "" } } }}; emit(doc.title.toUpperCase(),  jsonObj ); }}}'}}},i=function(e){setTimeout(function(){var e={pageSizeVal:500,pageIndexVal:0,include_docs:!0};dao.getDocView(r,o,e).done(function(e){n.resolve(e)}).fail(function(e){n.reject(e)})},2e3)};dao.createDocView(r,c).done(i).fail(function(e){n.reject(e)})}),n}}}();

},{}]},{},[1])(1)
});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uLy4uLy4uL3Vzci9sb2NhbC9saWIvbm9kZV9tb2R1bGVzL2Jyb3dzZXJpZnkvbm9kZV9tb2R1bGVzL2Jyb3dzZXItcGFjay9fcHJlbHVkZS5qcyIsImluZGV4LmpzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUFBO0FDQ0EsR0FBSSxXQUFZLEdBQ1osU0FDQSxRQUNBLFdBQ0EsNEJBQTZCLEVBSTdCLElBQU0sV0FLUixPQUdFLDBCQUEyQixTQUFTLEVBQVUsR0FFNUMsR0FBSSxHQUFNLEdBQUksR0FBRSxTQUdaLEVBQU0sVUFBWSxpQkFBa0IsSUFBTSxlQUFpQixJQUFNLGdCQUFrQixZQUNuRixFQUFTLE9BQ1QsRUFBVyxLQUFLLFdBQ2xCLEtBQVEsRUFBVSxTQUFZLElBRzVCLEdBQVEsRUFFUixFQUFVLEdBQUksZUFDbEIsR0FBUSxpQkFBa0IsRUFFMUIsRUFBUSxPQUFTLFdBRUQsRUFBUSxPQUNWLEVBQVEsY0FJdEIsRUFBUSxLQUFLLEVBQVEsRUFBSyxHQUUxQixFQUFRLGlCQUFpQixlQUFnQixrQ0FFekMsRUFBUSxLQUFLLEVBS2IsSUFBSSxHQUFNLFVBQVksaUJBQWtCLElBQU0sZUFBaUIsSUFBTSxpQkFBbUIsWUFDcEYsRUFBUyxPQUNULEVBQVcsS0FBSyxXQUNsQixLQUFRLEVBQVUsU0FBWSxJQUc1QixHQUFRLEVBRVIsRUFBVSxHQUFJLGVBd0JsQixPQXZCQSxHQUFRLGlCQUFrQixFQUUxQixFQUFRLE9BQVMsV0FFZCxHQUFJLEdBQVMsRUFBUSxPQUNqQixFQUFPLEVBQVEsWUFDTCxNQUFWLEdBRUQsNEJBQTZCLEVBQzdCLEVBQUksUUFBUSxJQUlaLEVBQUksT0FBTyxJQUlqQixFQUFRLEtBQUssRUFBUSxFQUFLLEdBRTFCLEVBQVEsaUJBQWlCLGVBQWdCLGtDQUV6QyxFQUFRLEtBQUssR0FFTixFQUFJLFdBSWIsSUFBSyxTQUFTLEdBRVosR0FBSSxHQUFNLEdBQUksR0FBRSxRQUNoQixLQUdJLEtBQUssUUFBVSxhQUdqQixRQUFR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U0FBUyxHQUNmLEVBQVMsT0FBTyxNQUdoQixLQUtOLEtBQUksY0FBYyxFQUFNLEdBQ3ZCLEtBQUssR0FDTCxLQUFLLFNBQVMsR0FBSyxFQUFTLE9BQU8sT0FZL0IiLCJmaWxlIjoiZ2VuZXJhdGVkLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXNDb250ZW50IjpbIihmdW5jdGlvbiBlKHQsbixyKXtmdW5jdGlvbiBzKG8sdSl7aWYoIW5bb10pe2lmKCF0W29dKXt2YXIgYT10eXBlb2YgcmVxdWlyZT09XCJmdW5jdGlvblwiJiZyZXF1aXJlO2lmKCF1JiZhKXJldHVybiBhKG8sITApO2lmKGkpcmV0dXJuIGkobywhMCk7dmFyIGY9bmV3IEVycm9yKFwiQ2Fubm90IGZpbmQgbW9kdWxlICdcIitvK1wiJ1wiKTt0aHJvdyBmLmNvZGU9XCJNT0RVTEVfTk9UX0ZPVU5EXCIsZn12YXIgbD1uW29dPXtleHBvcnRzOnt9fTt0W29dWzBdLmNhbGwobC5leHBvcnRzLGZ1bmN0aW9uKGUpe3ZhciBuPXRbb11bMV1bZV07cmV0dXJuIHMobj9uOmUpfSxsLGwuZXhwb3J0cyxlLHQsbixyKX1yZXR1cm4gbltvXS5leHBvcnRzfXZhciBpPXR5cGVvZiByZXF1aXJlPT1cImZ1bmN0aW9uXCImJnJlcXVpcmU7Zm9yKHZhciBvPTA7bzxyLmxlbmd0aDtvKyspcyhyW29dKTtyZXR1cm4gc30pIiwiXG52YXIgZ2xvYmFsdXJsID0gJyc7XG52YXIgbWFzdGVyREI7XG52YXIgbG9jYWxEQjtcbnZhciB0YXhvbm9teURCO1xudmFyIGF1dGhlbnRpY2F0ZWRUb1N5bmNHYXRld2F5ID0gZmFsc2U7XG5cblxuLy8gRGF0YSBBY2Nlc3MgT2JqZWN0IC8gTW9kdWxlXG52YXIgZGFvID0gKGZ1bmN0aW9uKCl7XG5cblxuICAvL0RCTkFNRSArIERCX0lERU5USUZJRVIgaXMgbG9jYWwgZGF0YWJhc2UgbmFtZSwgZG8gbm90IGdldCBjb25mdXNlZCB3aXRoIEJVQ0tFVFxuXG4gIHJldHVybiB7XG5cbiAgICAvLyBHZXQgYSBkb2N1bWVudCBmcm9tIHRoZSBkYXRhYmFzZXNcbiAgICBhdXRoZW50aWNhdGVUb1N5bmNHYXRld2F5OiBmdW5jdGlvbih1c2VybmFtZSwgcGFzc3dvcmQpe1xuICAgICAgLy9hbGVydCgnVGVzdCcrdXNlcm5hbWUgKyBwYXNzd29yZCk7XG4gICAgICB2YXIgZGZkID0gbmV3ICQuRGVmZXJyZWQoKTtcblxuXG4gICAgICB2YXIgdXJsID0gJ2h0dHA6Ly8nICsgQ09VQ0hCQVNFX0RPTUFJTiArJzonICsgQ09VQ0hCQVNFX1BPUlQgKyAnLycgKyBUQVhPTk9NWV9CVUNLRVQgKyBcIi9fc2Vzc2lvblwiO1xuICAgICAgdmFyIG1ldGhvZCA9IFwiUE9TVFwiO1xuICAgICAgdmFyIHBvc3REYXRhID0gSlNPTi5zdHJpbmdpZnkoe1xuICAgICAgICBcIm5hbWVcIjogdXNlcm5hbWUsIFwicGFzc3dvcmRcIjogcGFzc3dvcmRcbiAgICAgIH0pO1xuXG4gICAgICB2YXIgYXN5bmMgPSB0cnVlO1xuXG4gICAgICB2YXIgcmVxdWVzdCA9IG5ldyBYTUxIdHRwUmVxdWVzdCgpO1xuICAgICAgcmVxdWVzdC53aXRoQ3JlZGVudGlhbHMgPSB0cnVlO1xuXG4gICAgICByZXF1ZXN0Lm9ubG9hZCA9IGZ1bmN0aW9uICgpIHtcblxuICAgICAgICAgdmFyIHN0YXR1cyA9IHJlcXVlc3Quc3RhdHVzO1xuICAgICAgICAgdmFyIGRhdGEgPSByZXF1ZXN0LnJlc3BvbnNlVGV4dDtcblxuICAgICAgfVxuXG4gICAgICByZXF1ZXN0Lm9wZW4obWV0aG9kLCB1cmwsIGFzeW5jKTtcblxuICAgICAgcmVxdWVzdC5zZXRSZXF1ZXN0SGVhZGVyKFwiQ29udGVudC1UeXBlXCIsIFwiYXBwbGljYXRpb24vanNvbjtjaGFyc2V0PVVURi04XCIpO1xuXG4gICAgICByZXF1ZXN0LnNlbmQocG9zdERhdGEpO1xuXG5cblxuXG4gICAgICB2YXIgdXJsID0gJ2h0dHA6Ly8nICsgQ09VQ0hCQVNFX0RPTUFJTiArJzonICsgQ09VQ0hCQVNFX1BPUlQgKyAnLycgKyBDT1VDSEJBU0VfQlVDS0VUICsgXCIvX3Nlc3Npb25cIjtcbiAgICAgIHZhciBtZXRob2QgPSBcIlBPU1RcIjtcbiAgICAgIHZhciBwb3N0RGF0YSA9IEpTT04uc3RyaW5naWZ5KHtcbiAgICAgICAgXCJuYW1lXCI6IHVzZXJuYW1lLCBcInBhc3N3b3JkXCI6IHBhc3N3b3JkXG4gICAgICB9KTtcblxuICAgICAgdmFyIGFzeW5jID0gdHJ1ZTtcblxuICAgICAgdmFyIHJlcXVlc3QgPSBuZXcgWE1MSHR0cFJlcXVlc3QoKTtcbiAgICAgIHJlcXVlc3Qud2l0aENyZWRlbnRpYWxzID0gdHJ1ZTtcblxuICAgICAgcmVxdWVzdC5vbmxvYWQgPSBmdW5jdGlvbiAoKSB7XG5cbiAgICAgICAgIHZhciBzdGF0dXMgPSByZXF1ZXN0LnN0YXR1cztcbiAgICAgICAgIHZhciBkYXRhID0gcmVxdWVzdC5yZXNwb25zZVRleHQ7XG4gICAgICAgICAgaWYoc3RhdHVzID09IDIwMClcbiAgICAgICAgICB7XG4gICAgICAgICAgICBhdXRoZW50aWNhdGVkVG9TeW5jR2F0ZXdheSA9IHRydWU7XG4gICAgICAgICAgICBkZmQucmVzb2x2ZShkYXRhKTtcbiAgICAgICAgICB9XG4gICAgICAgICAgZWxzZVxuICAgICAgICAgIHtcbiAgICAgICAgICAgIGRmZC5yZWplY3QoZGF0YSk7XG4gICAgICAgICAgfVxuICAgICAgfVxuXG4gICAgICByZXF1ZXN0Lm9wZW4obWV0aG9kLCB1cmwsIGFzeW5jKTtcblxuICAgICAgcmVxdWVzdC5zZXRSZXF1ZXN0SGVhZGVyKFwiQ29udGVudC1UeXBlXCIsIFwiYXBwbGljYXRpb24vanNvbjtjaGFyc2V0PVVURi04XCIpO1xuXG4gICAgICByZXF1ZXN0LnNlbmQocG9zdERhdGEpO1xuXG4gICAgICByZXR1cm4gZGZkLnByb21pc2UoKTtcblxuICAgIH0sXG5cbiAgICBnZXQ6IGZ1bmN0aW9uKGRvY0lkKXtcblxuICAgICAgdmFyIGRmZCA9IG5ldyAkLkRlZmVycmVkKCk7XG4gICAgICB0cnl7XG4gICAgICAgLy9jb25zb2xlLmxvZyhcIkZldGNoaW5nIG9iamVjdCA9PSBcIitkb2NJZCk7XG5cbiAgICAgIGlmIChoZWFkLm1vYmlsZSAmJiBpc0NvcmRvdmFBcHApIHtcblxuXG4gICAgICAgIGNvcmRvdmEuZXhlYyhmdW5jdGlvbihkYXRhKXtcblxuICAgICAgICAgIGRmZC5yZXNvbHZlKGRhdGEpO1xuXG4gICAgICAgIH0sIGZ1bmN0aW9uKGUpe1xuICAgICAgICAgIGRmZC5yZWplY3QoZSlcbiAgICAgICAgfSwgJ0NCTGl0ZScsICdnZXREb2N1bWVudCcsXG4gICAgICAgICAgW3tcImRibmFtZVwiOiBEQk5BTUUgKyBEQl9JREVOVElGSUVSLCBcImRvY0lkXCI6IGRvY0lkfV1cbiAgICAgICAgKTtcblxuXG4gICAgICB9IGVsc2Uge1xuXG4gICAgICAgICBsb2NhbERCLmdldChkb2NJZClcbiAgICAgICAgICAudGhlbihmdW5jdGlvbihkYXRhKXtcbiAgICAgICAgICAgIGRmZC5yZXNvbHZlKGRhdGEpO1xuICAgICAgICAgIH0pLmNhdGNoKGZ1bmN0aW9uKGVycil7XG4gICAgICAgICAgICBjb25zb2xlLmxvZyhcIkRlc2t0b3AgLSBlcnJvciBpbiBnZXR0aW5nIGRvY3VtZW50IHdpdGggaWQ6IFwiICsgZG9jSWQgKyBcIi4gRXJyb3Igc3RhY2t0cmFjZTogXCIgKyBlcnIpO1xuICAgICAgICAgICAgZGZkLnJlamVjdChlcnIpO1xuICAgICAgICAgICAgcmV0dXJuIGVycjtcbiAgICAgICAgICB9KTtcblxuICAgICAgfVxuICAgICAgfWNhdGNoKGUpXG4gICAgICB7XG4gICAgICAgIGRmZC5yZWplY3QoZSk7XG4gICAgICB9XG4gICAgICByZXR1cm4gZGZkLnByb21pc2UoKTtcbiAgICB9LFxuXG4gICAgZ2V0VGF4b25vbXk6IGZ1bmN0aW9uKGRvY0lkKXtcblxuICAgICAgdmFyIGRmZCA9IG5ldyAkLkRlZmVycmVkKCk7XG5cbiAgICAgICAvL2NvbnNvbGUubG9nKFwiRmV0Y2hpbmcgb2JqZWN0ID09IFwiK2RvY0lkKTtcblxuICAgICAgaWYgKGhlYWQubW9iaWxlICYmIGlzQ29yZG92YUFwcCkge1xuXG4gICAgICAgIGNvcmRvdmEuZXhlYyhmdW5jdGlvbihkYXRhKXtcblxuICAgICAgICAgIGRmZC5yZXNvbHZlKGRhdGEpO1xuXG4gICAgICAgIH0sIGZ1bmN0aW9uKGUpe1xuICAgICAgICAgIGRmZC5yZWplY3QoZSlcbiAgICAgICAgfSwgJ0NCTGl0ZScsICdnZXREb2N1bWVudCcsXG4gICAgICAgICAgW3tcImRibmFtZVwiOiBUQVhPTk9NWV9EQk5BTUUgKyBEQl9JREVOVElGSUVSLCBcImRvY0lkXCI6IGRvY0lkfV1cbiAgICAgICAgKTtcblxuXG4gICAgICB9IGVsc2Uge1xuXG4gICAgICAgICB0YXhvbm9teURCLmdldChkb2NJZClcbiAgICAgICAgICAudGhlbihmdW5jdGlvbihkYXRhKXtcbiAgICAgICAgICAgIGRmZC5yZXNvbHZlKGRhdGEpO1xuICAgICAgICAgIH0pLmNhdGNoKGZ1bmN0aW9uKGVycil7XG4gICAgICAgICAgICBjb25zb2xlLmxvZyhcIkRlc2t0b3AgLSBlcnJvciBpbiBnZXR0aW5nIHRheG9ub215IHdpdGggaWQ6IFwiICsgZG9jSWQgKyBcIi4gRXJyb3Igc3RhY2t0cmFjZTogXCIgKyBlcnIpO1xuICAgICAgICAgICAgZGZkLnJlamVjdChlcnIpO1xuICAgICAgICAgICAgcmV0dXJuIGVycjtcbiAgICAgICAgICB9KTtcblxuICAgICAgfVxuXG4gICAgICByZXR1cm4gZGZkLnByb21pc2UoKTtcbiAgICB9LFxuXG4gICAgLy9TYXZlIHRoZSBkb2N1bWVudCBpbnRvIHRoZSBkYXRhYmFzZVxuICAgIHNhdmU6IGZ1bmN0aW9uKGRvYyl7XG4gICAgICAvLyBjb25zb2xlLmxvZyhcIlNhdmluZyA9PSBcIitkb2MuX2lkKTtcbiAgICAgIHZhciBkZmQgPSBuZXcgJC5EZWZlcnJlZCgpO1xuXG4gICAgICBpZiAoaGVhZC5tb2JpbGUgJiYgaXNDb3Jkb3ZhQXBwKSB7XG5cbiAgICAgICAgaWYoZG9jLl9pZC5pbmRleE9mKCdfZGVzaWduJykgIT0gMClcbiAgICAgICAge1xuICAgICAgICAgIGNvcmRvdmEuZXhlYyhmdW5jdGlvbihkYXRhKXtcblxuICAgICAgICAgICAgZGZkLnJlc29sdmUoZGF0YSk7XG5cbiAgICAgICAgICB9LCBmdW5jdGlvbihlKXtcbiAgICAgICAgICAgIGRmZC5yZWplY3QoZSlcbiAgICAgICAgICB9LCAnQ0JMaXRlJywgJ3NhdmVEb2N1bWVudCcsXG4gICAgICAgICAgICBbe1wiZGJuYW1lXCI6IERCTkFNRSArIERCX0lERU5USUZJRVIsIFwiZG9jSWRcIjogZG9jLl9pZCwgXCJkb2NcIjpkb2N9XVxuICAgICAgICAgICk7XG4gICAgICAgIH1cbiAgICAgICAgZWxzZVxuICAgICAgICB7XG5cbiAgICAgICAgICAgIHZhciBvcHRpb25zID0ge1xuICAgICAgICAgICAgdXJsOiBnbG9iYWx1cmwgKyBEQk5BTUUgKyBEQl9JREVOVElGSUVSICsgXCIvXCIgKyBkb2MuX2lkLFxuICAgICAgICAgICAgICAgICAgICB0eXBlOiBcIlBVVFwiLFxuICAgICAgICAgICAgICAgICAgICBkYXRhOiAgSlNPTi5zdHJpbmdpZnkoZG9jKSxcbiAgICAgICAgICAgICAgICAgICAgZGF0YVR5cGU6IFwianNvblwiLFxuICAgICAgICAgICAgICAgICAgICBjb250ZW50VHlwZTogXCJhcHBsaWNhdGlvbi9qc29uXCJcbiAgICAgICAgICB9O1xuXG4gICAgICAgICAgJC5hamF4KG9wdGlvbnMpXG4gICAgICAgICAgLmRvbmUoZnVuY3Rpb24oZGF0YSwgdGV4dFN0YXR1cywgeGhyKXtcbiAgICAgICAgICAgIGRmZC5yZXNvbHZlKGRhdGEpO1xuICAgICAgICAgIH0pXG4gICAgICAgICAgLmZhaWwoZnVuY3Rpb24oeGhyLCB0ZXh0U3RhdHVzLCBlcnJvclRocm93bil7XG4gICAgICAgICAgICBjb25zb2xlLmxvZyhcIk1vYmlsZSAtIGVycm9yIGluIHNhdmluZyBkb2N1bWVudCB3aXRoIGlkOiBcIiArIGRvYy5faWQgKyBcIi4gVVJMOiBcIiArIGdsb2JhbHVybCArIERCTkFNRSArIERCX0lERU5USUZJRVIgKyBcIiBFcnJvciBzdGFja3RyYWNlOiBcIiArIEpTT04uc3RyaW5naWZ5KHhocikpO1xuICAgICAgICAgICAgZGZkLnJlamVjdCh4aHIucmVzcG9uc2VUZXh0KTtcbiAgICAgICAgICB9KTtcblxuICAgICAgICB9XG5cblxuXG5cbiAgICAgIH0gZWxzZSB7XG5cbiAgICAgICAgbG9jYWxEQi5wdXQoZG9jKVxuICAgICAgICAudGhlbihmdW5jdGlvbihkYXRhKXtcbiAgICAgICAgICBkZmQucmVzb2x2ZShkYXRhKTtcbiAgICAgICAgfSkuY2F0Y2goZnVuY3Rpb24oZXJyKXtcbiAgICAgICAgICBjb25zb2xlLmxvZyhcIkRlc2t0b3AgLSBlcnJvciBpbiBzYXZpbmcgZG9jdW1lbnQgd2l0aCBpZDogXCIgKyBkb2MuX2lkICsgXCIuIEVycm9yIHN0YWNrdHJhY2U6IFwiICsgZXJyKTtcbiAgICAgICAgICBkZmQucmVqZWN0KGVycik7XG4gICAgICAgIH0pO1xuICAgICAgfVxuXG4gICAgICByZXR1cm4gZGZkLnByb21pc2UoKTtcbiAgICB9LFxuXG4gICAgc2F2ZUF0dGFjaG1lbnQgOmZ1bmN0aW9uKGRvY0lkLCByZXZJZCwgYXR0YWNoZW1udCwgbWltZVR5cGUsIGF0dGFjaGVtbnROYW1lKVxuICAgIHtcbiAgICAgIHZhciBkZmQgPSBuZXcgJC5EZWZlcnJlZCgpO1xuXG4gICAgICBpZiAoaGVhZC5tb2JpbGUgJiYgaXNDb3Jkb3ZhQXBwKSB7XG5cbiAgICAgICAgYmxvYlV0aWwuYmFzZTY0U3RyaW5nVG9CbG9iKGF0dGFjaGVtbnQsIG1pbWVUeXBlKS50aGVuKGZ1bmN0aW9uIChibG9iKSB7XG5cbiAgICAgICAgICB2YXIgb1JlcSA9IG5ldyBYTUxIdHRwUmVxdWVzdCgpO1xuXG4gICAgICAgICAgb1JlcS5vcGVuKFwiUFVUXCIsIGdsb2JhbHVybCArIERCTkFNRSArIERCX0lERU5USUZJRVIgKyBcIi9cIiArIGRvY0lkICsgXCIvXCIgKyBhdHRhY2hlbW50TmFtZSArIFwiP3Jldj1cIiArIHJldklkLCB0cnVlKTtcblxuICAgICAgICAgIG9SZXEub25sb2FkID0gZnVuY3Rpb24gKG9FdmVudCkge1xuXG4gICAgICAgICAgICBkZmQucmVzb2x2ZShKU09OLnBhcnNlKG9SZXEucmVzcG9uc2VUZXh0KSk7XG4gICAgICAgICAgfTtcblxuXG4gICAgICAgICAgb1JlcS5zZW5kKGJsb2IpO1xuXG5cbiAgICAgICAgICB9KS5jYXRjaChmdW5jdGlvbiAoZXJyKSB7XG4gICAgICAgICAgICBjb25zb2xlLmxvZyhlcnIpO1xuICAgICAgICAgICAgZGZkLnJlamVjdCh4aHIucmVzcG9uc2VUZXh0KTtcbiAgICAgICAgICB9KTtcblxuXG5cblxuICAgICAgfSBlbHNlIHtcbiAgICAgICAgLy8gUGVyZm9ybSBvcGVyYXRpb24gb24gdGhlIFBvdWNoREIgZGF0YWJhc2VcblxuICAgICAgIGxvY2FsREIucHV0QXR0YWNobWVudChkb2NJZCwgYXR0YWNoZW1udE5hbWUsIHJldklkLCBhdHRhY2hlbW50LCBtaW1lVHlwZSlcbiAgICAgICAgICAgIC50aGVuKGZ1bmN0aW9uKGRhdGEpe1xuICAgICAgICAgICAgICBkZmQucmVzb2x2ZShkYXRhKTtcbiAgICAgICAgICAgIH0pLmNhdGNoKGZ1bmN0aW9uKGVycil7XG4gICAgICAgICAgICAgIGNvbnNvbGUubG9nKFwiRGVza3RvcCAtZXJyb3IgaW4gc2F2aW5nIGF0dGFjaG1lbnQgdG8gdGhlIGRvY3VtZW50IHdpdGggaWQ6IFwiICsgZG9jSWQgKyBcIi4gRXJyb3Igc3RhY2t0cmFjZTogXCIgKyBlcnIpO1xuICAgICAgICAgICAgICBkZmQucmVqZWN0KGVycik7XG4gICAgICAgICAgICB9KTtcblxuXG4gICAgICB9XG4gICAgICAgICAgcmV0dXJuIGRmZC5wcm9taXNlKCk7XG4gICAgfSxcblxuICAgIGdldEF0dGFjaG1lbnQgOmZ1bmN0aW9uKGRvY0lkLCByZXZJZCwgYXR0YWNoZW1udE5hbWUpXG4gICAge1xuICAgICAgICB2YXIgZGZkID0gbmV3ICQuRGVmZXJyZWQoKTtcbiAgICAgICAgaWYgKGhlYWQubW9iaWxlICYmIGlzQ29yZG92YUFwcCkge1xuICAgICAgICAvLyBQZXJmb3JtIG9wZXJhdGlvbiBvbiB0aGUgQ291Y2hiYXNlIExpdGUgZGF0YWJhc2VcblxuICAgICAgICAgIHZhciB4aHIgPSBuZXcgWE1MSHR0cFJlcXVlc3QoKTtcbiAgICAgICAgICB4aHIub3BlbignR0VUJywgZ2xvYmFsdXJsICsgREJOQU1FICsgREJfSURFTlRJRklFUiArIFwiL1wiICsgZG9jSWQgKyBcIi9cIiArIGF0dGFjaGVtbnROYW1lLCB0cnVlKTtcbiAgICAgICAgICB4aHIucmVzcG9uc2VUeXBlID0gJ2Jsb2InO1xuXG4gICAgICAgICAgeGhyLm9ubG9hZCA9IGZ1bmN0aW9uKGUpIHtcbiAgICAgICAgICAgIGlmICh0aGlzLnN0YXR1cyA9PSAyMDApIHtcblxuICAgICAgICAgICAgICB2YXIgYmxvYiA9IHhoci5yZXNwb25zZTtcblxuICAgICAgICAgICAgICBibG9iVXRpbC5ibG9iVG9CYXNlNjRTdHJpbmcoYmxvYikudGhlbihmdW5jdGlvbiAoYmFzZTY0U3RyaW5nKSB7XG5cbiAgICAgICAgICAgICAgICBkZmQucmVzb2x2ZShiYXNlNjRTdHJpbmcpO1xuXG4gICAgICAgICAgICAgIH0pLmNhdGNoKGZ1bmN0aW9uIChlcnIpIHtcblxuICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKFwiTW9iaWxlIC0gZXJyb3IgaW4gZ2V0dGluZyBhdHRhY2htZW50IHRvIHRoZSBkb2N1bWVudCB3aXRoIGlkOiBcIiArIGRvY0lkICsgXCIuIEVycm9yIHN0YWNrdHJhY2U6IFwiICsgZXJyKTtcbiAgICAgICAgICAgICAgICBkZmQucmVqZWN0KHhocik7XG5cbiAgICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2V7XG4gICAgICAgICAgICAgIGNvbnNvbGUubG9nKFwiTW9iaWxlIC0gZXJyb3IgaW4gZ2V0dGluZyBhdHRhY2htZW50IHRvIHRoZSBkb2N1bWVudCB3aXRoIGlkOiBcIiArIGRvY0lkKTtcbiAgICAgICAgICAgICAgICBkZmQucmVqZWN0KHhocik7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgfTtcblxuICAgICAgICAgIHhoci5zZW5kKCk7XG5cblxuICAgICAgfSBlbHNlIHtcbiAgICAgICAgLy8gUGVyZm9ybSBvcGVyYXRpb24gb24gdGhlIFBvdWNoREIgZGF0YWJhc2VcbiAgICAgICAgIGxvY2FsREIuZ2V0QXR0YWNobWVudChkb2NJZCwgYXR0YWNoZW1udE5hbWUpXG4gICAgICAgIC50aGVuKGZ1bmN0aW9uIChibG9iT3JCdWZmZXIpIHtcblxuICAgICAgICAgICAgICAgICBibG9iVXRpbC5ibG9iVG9CYXNlNjRTdHJpbmcoYmxvYk9yQnVmZmVyKS50aGVuKGZ1bmN0aW9uIChiaW5hcnlTdHJpbmcpIHtcbiAgICAgICAgICAgICAgICBkZmQucmVzb2x2ZShiaW5hcnlTdHJpbmcpO1xuICAgICAgICAgICAgICB9KS5jYXRjaChmdW5jdGlvbiAoZXJyKSB7XG4gICAgICAgICAgICAgICBkZmQucmVqZWN0KGVycik7XG4gICAgICAgICAgICAgIH0pO1xuXG4gICAgICAgIH0pLmNhdGNoKGZ1bmN0aW9uIChlcnIpIHtcbiAgICAgICAgIGNvbnNvbGUubG9nKFwiRGVza3RvcCAtZXJyb3IgaW4gZ2V0dGluZyBhdHRhY2htZW50IHRvIHRoZSBkb2N1bWVudCB3aXRoIGlkOiBcIiArIGRvY0lkICsgXCIuIEVycm9yIHN0YWNrdHJhY2U6IFwiICsgZXJyKTtcbiAgICAgICAgIGRmZC5yZWplY3QoZXJyKTtcbiAgICAgICAgfSk7XG4gICAgICB9XG4gICAgICAgICAgcmV0dXJuIGRmZC5wcm9taXNlKCk7XG4gICB9LFxuXG4gICBkZWxldGVBdHRhY2htZW50IDpmdW5jdGlvbihkb2NJZCwgcmV2SWQsIGF0dGFjaGVtbnROYW1lKVxuICAge1xuICAgICB2YXIgZGZkID0gbmV3ICQuRGVmZXJyZWQoKTtcbiAgICAgIGlmIChoZWFkLm1vYmlsZSAmJiBpc0NvcmRvdmFBcHApIHtcbiAgICAvLyBQZXJmb3JtIG9wZXJhdGlvbiBvbiB0aGUgQ291Y2hiYXNlIExpdGUgZGF0YWJhc2VcbiAgICAgICAgdmFyIG9wdGlvbnMgPSB7XG4gICAgICAgICAgdXJsOiBnbG9iYWx1cmwgKyBEQk5BTUUgKyBEQl9JREVOVElGSUVSICsgXCIvXCIgKyBkb2NJZCArIFwiL1wiICsgYXR0YWNoZW1udE5hbWUgKyBcIj9yZXY9XCIgKyByZXZJZCxcbiAgICAgICAgICAgICAgICAgIHR5cGU6IFwiREVMRVRFXCIsXG4gICAgICAgICAgICAgICAgICBkYXRhVHlwZTogXCJqc29uXCJcbiAgICAgICAgfTtcblxuICAgICAgICAkLmFqYXgob3B0aW9ucylcbiAgICAgICAgLmRvbmUoZnVuY3Rpb24oZGF0YSwgdGV4dFN0YXR1cywgeGhyKXtcbiAgICAgICAgICBkZmQucmVzb2x2ZShkYXRhKTtcbiAgICAgICAgfSlcbiAgICAgICAgLmZhaWwoZnVuY3Rpb24oeGhyLCB0ZXh0U3RhdHVzLCBlcnJvclRocm93bil7XG4gICAgICAgICAgY29uc29sZS5sb2coXCJNb2JpbGUgLSBlcnJvciBpbiBkZWxldGluZyBhdHRhY2htZW50IHRvIHRoZSBkb2N1bWVudCB3aXRoIGlkOiBcIiArIGRvY0lkICsgXCIuIEVycm9yIHN0YWNrdHJhY2U6IFwiICsgSlNPTi5zdHJpbmdpZnkoeGhyKSk7XG4gICAgICAgICAgZGZkLnJlamVjdCh4aHIucmVzcG9uc2VUZXh0KTtcbiAgICAgICAgfSk7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICAvLyBDaGVjayBpZiB0aGUgZGF0YSBleGlzdHMgaW4gdGhlIGxvY2FsIFBvdWNoREJcbiAgICAgICAgbG9jYWxEQi5yZW1vdmVBdHRhY2htZW50KGRvY0lkLCBhdHRhY2hlbW50TmFtZSwgcmV2SWQpXG4gICAgICAgIC50aGVuKGZ1bmN0aW9uIChyZXN1bHQpIHtcbiAgICAgICAgICBkZmQucmVzb2x2ZShyZXN1bHQpO1xuICAgICAgICB9KS5jYXRjaChmdW5jdGlvbiAoZXJyKSB7XG4gICAgICAgICAgY29uc29sZS5sb2coXCJEZXNrdG9wIC0gZXJyb3IgaW4gZGVsZXRpbmcgYXR0YWNobWVudCB0byB0aGUgZG9jdW1lbnQgd2l0aCBpZDogXCIgKyBkb2NJZCArIFwiLiBFcnJvciBzdGFja3RyYWNlOiBcIiArIEpTT04uc3RyaW5naWZ5KHhocikpO1xuICAgICAgICAgIGRmZC5yZWplY3QoZXJyKTtcbiAgICAgICAgfSk7XG4gICAgICB9XG4gICAgICAgICAgcmV0dXJuIGRmZC5wcm9taXNlKCk7XG4gICB9LFxuXG4gICAgdXBzZXJ0OiBmdW5jdGlvbihkb2N1bWVudClcbiAgICB7XG4gICAgICAgIHZhciBkZmQgPSBuZXcgJC5EZWZlcnJlZCgpO1xuXG4gICAgICB2YXIgc0NCID0gZnVuY3Rpb24oZG9jKXtcblxuICAgICAgICBkb2N1bWVudC5fcmV2ID0gZG9jLl9yZXY7XG5cbiAgICAgICAgZGFvLnNhdmUoZG9jdW1lbnQpXG4gICAgICAgIC5kb25lKGZ1bmN0aW9uKHMpe2RmZC5yZXNvbHZlKHMpfSlcbiAgICAgICAgLmZhaWwoZnVuY3Rpb24oZSl7ZGZkLnJlamVjdChlKX0pO1xuXG4gICAgICB9XG5cbiAgICAgIHZhciBlQ0IgPSBmdW5jdGlvbihlcnIpe1xuICAgICAgICBkYW8uc2F2ZShkb2N1bWVudClcbiAgICAgICAgLmRvbmUoZnVuY3Rpb24ocyl7Y29uc29sZS5sb2cocyk7ZGZkLnJlc29sdmUocyk7fSlcbiAgICAgICAgLmZhaWwoZnVuY3Rpb24oZSl7ZGZkLnJlamVjdChlKX0pO1xuICAgICAgfVxuXG4gICAgICBkYW8uZ2V0KGRvY3VtZW50Ll9pZClcbiAgICAgIC5kb25lKHNDQilcbiAgICAgIC5mYWlsKGVDQik7XG5cbiAgICAgIHJldHVybiBkZmQucHJvbWlzZSgpO1xuICAgIH0sXG4gICAgc3RhcnRQdWxsOiBmdW5jdGlvbigpXG4gICAge1xuXG4gICAgICAgIHZhciBkZmQgPSBuZXcgJC5EZWZlcnJlZCgpO1xuXG4gICAgICAgIHZhciBzeW5jVXNlcm5hbWUgPSBMT0NBTF9TRVRUSU5HUy5TVUJTQ1JJUFRJT05TLnN5bmNVc2VybmFtZTtcbiAgICAgICAgdmFyIHN5bmNQYXNzd29yZCA9IExPQ0FMX1NFVFRJTkdTLlNVQlNDUklQVElPTlMuc3luY1Bhc3N3b3JkO1xuXG4gICAgICAgIGlmIChoZWFkLm1vYmlsZSAmJiBpc0NvcmRvdmFBcHApIHtcblxuICAgICAgICAgIGNvcmRvdmEuZXhlYyhcbiAgICAgICAgICAgIGZ1bmN0aW9uKHMpe1NZTkNfU0VRID0gczsgZGZkLnJlc29sdmUocyl9LFxuICAgICAgICAgICAgZnVuY3Rpb24oZSl7ZGZkLnJlamVjdChlKX0sXG4gICAgICAgICAgICAgICAgICAgJ0NCTGl0ZScsXG4gICAgICAgICAgICAgICAgICAgJ3B1bGwnLFxuICAgICAgICAgICAgICAgICAgIFt7XCJkYm5hbWVcIjogREJOQU1FICsgREJfSURFTlRJRklFUiwgXCJ1cmxcIjonaHR0cDovLycrc3luY1VzZXJuYW1lKyc6JytzeW5jUGFzc3dvcmQrJ0AnK0NPVUNIQkFTRV9ET01BSU4gKyc6JyArIENPVUNIQkFTRV9QT1JUICsgJy8nICsgQ09VQ0hCQVNFX0JVQ0tFVH1dXG4gICAgICAgICAgICAgICApO1xuXG4gICAgICAgIH1cbiAgICAgICAgZWxzZXtcblxuXG4gICAgICAgICAgICAgIGlmKGF1dGhlbnRpY2F0ZWRUb1N5bmNHYXRld2F5ID09IGZhbHNlKVxuICAgICAgICAgICAgICB7XG5cblxuICAgICAgICAgICAgICAgIGRhby5hdXRoZW50aWNhdGVUb1N5bmNHYXRld2F5KHN5bmNVc2VybmFtZSwgc3luY1Bhc3N3b3JkKVxuICAgICAgICAgICAgICAgIC5kb25lKFxuICAgICAgICAgICAgICAgICAgICAgICBmdW5jdGlvbiAoZGF0YSlcbiAgICAgICAgICAgICAgICAgICAgICAge1xuXG5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgIGxvY2FsREIucmVwbGljYXRlLmZyb20obmV3IFBvdWNoREIoJ2h0dHA6Ly8nICsgQ09VQ0hCQVNFX0RPTUFJTiArJzonICsgQ09VQ0hCQVNFX1BPUlQgKyAnLycgKyBDT1VDSEJBU0VfQlVDS0VULFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFqYXg6IHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGltZW91dDogNjAwMDBcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICBsaXZlOiBmYWxzZSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHJ5OiB0cnVlLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGltZW91dDogNjAwMDBcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIC50aGVuKGZ1bmN0aW9uIChyZXN1bHQpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vU1lOQ19TRVEgPSBcIlwiK3Jlc3VsdC5jaGFuZ2UubGFzdF9zZXE7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICBkZmQucmVzb2x2ZShcIlwiKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KS5jYXRjaChmdW5jdGlvbiAoZXJyKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICBkZmQucmVqZWN0KGVycik7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgKS5mYWlsKFxuICAgICAgICAgICAgICAgICAgICAgICBmdW5jdGlvbihlcnIpe2RmZC5yZWplY3QoZXJyKTt9XG4gICAgICAgICAgICAgICAgICk7XG5cbiAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICBlbHNle1xuXG4gICAgICAgICAgICAgICAgIGxvY2FsREIucmVwbGljYXRlLmZyb20obmV3IFBvdWNoREIoJ2h0dHA6Ly8nICsgQ09VQ0hCQVNFX0RPTUFJTiArJzonICsgQ09VQ0hCQVNFX1BPUlQgKyAnLycgKyBDT1VDSEJBU0VfQlVDS0VULFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFqYXg6IHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGltZW91dDogNjAwMDBcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICBsaXZlOiBmYWxzZSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHJ5OiB0cnVlLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGltZW91dDogNjAwMDBcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KVxuICAgICAgICAgICAgICAgIC50aGVuKGZ1bmN0aW9uIChyZXN1bHQpIHtcbiAgICAgICAgICAgICAgICAgIC8vU1lOQ19TRVEgPSBcIlwiK3Jlc3VsdC5jaGFuZ2UubGFzdF9zZXE7XG4gICAgICAgICAgICAgICAgICBkZmQucmVzb2x2ZShcIlwiKTtcbiAgICAgICAgICAgICAgICB9KS5jYXRjaChmdW5jdGlvbiAoZXJyKSB7XG4gICAgICAgICAgICAgICAgICBkZmQucmVqZWN0KGVycik7XG4gICAgICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgICAgfVxuXG5cblxuICAgICAgICB9XG5cbiAgICAgICAgcmV0dXJuIGRmZC5wcm9taXNlKCk7XG4gICAgICB9LFxuXG4gICAgICBwdWxsVGF4b25vbWllczogZnVuY3Rpb24oKVxuICAgIHtcblxuICAgICAgICB2YXIgZGZkID0gbmV3ICQuRGVmZXJyZWQoKTtcblxuICAgICAgICB2YXIgc3luY1VzZXJuYW1lID0gTE9DQUxfU0VUVElOR1MuU1VCU0NSSVBUSU9OUy5zeW5jVXNlcm5hbWU7XG4gICAgICAgIHZhciBzeW5jUGFzc3dvcmQgPSBMT0NBTF9TRVRUSU5HUy5TVUJTQ1JJUFRJT05TLnN5bmNQYXNzd29yZDtcblxuICAgICAgICBpZiAoaGVhZC5tb2JpbGUgJiYgaXNDb3Jkb3ZhQXBwKSB7XG5cbiAgICAgICAgICBjb3Jkb3ZhLmV4ZWMoXG4gICAgICAgICAgICAgZnVuY3Rpb24ocyl7ZGZkLnJlc29sdmUocyl9LFxuICAgICAgICAgICAgZnVuY3Rpb24oZSl7ZGZkLnJlamVjdChlKX0sXG4gICAgICAgICAgICAgICAgICAgJ0NCTGl0ZScsXG4gICAgICAgICAgICAgICAgICAgJ3B1bGwnLFxuICAgICAgICAgICAgICAgICAgIFt7XCJkYm5hbWVcIjogVEFYT05PTVlfREJOQU1FICsgREJfSURFTlRJRklFUiwgXCJ1cmxcIjonaHR0cDovLycrc3luY1VzZXJuYW1lKyc6JytzeW5jUGFzc3dvcmQrJ0AnK0NPVUNIQkFTRV9ET01BSU4gKyc6JyArIENPVUNIQkFTRV9QT1JUICsgJy8nICsgVEFYT05PTVlfQlVDS0VUfV1cbiAgICAgICAgICAgICAgICk7XG5cblxuXG4gICAgICAgIH1cbiAgICAgICAgZWxzZXtcblxuXG4gICAgICAgICAgICAgIGlmKGF1dGhlbnRpY2F0ZWRUb1N5bmNHYXRld2F5ID09IGZhbHNlKVxuICAgICAgICAgICAgICB7XG5cblxuICAgICAgICAgICAgICAgIGRhby5hdXRoZW50aWNhdGVUb1N5bmNHYXRld2F5KHN5bmNVc2VybmFtZSwgc3luY1Bhc3N3b3JkKVxuICAgICAgICAgICAgICAgIC5kb25lKFxuICAgICAgICAgICAgICAgICAgICAgICBmdW5jdGlvbiAoZGF0YSlcbiAgICAgICAgICAgICAgICAgICAgICAge1xuXG4gICAgICAgICAgICAgICAgICAgICAgICAgIHRheG9ub215REIucmVwbGljYXRlLmZyb20obmV3IFBvdWNoREIoJ2h0dHA6Ly8nICsgQ09VQ0hCQVNFX0RPTUFJTiArJzonICsgQ09VQ0hCQVNFX1BPUlQgKyAnLycgKyBUQVhPTk9NWV9CVUNLRVQsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYWpheDoge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aW1lb3V0OiA2MDAwMFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxpdmU6IGZhbHNlLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0cnk6IHRydWUsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aW1lb3V0OiA2MDAwMFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgLnRoZW4oZnVuY3Rpb24gKHJlc3VsdCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLy9TWU5DX1NFUSA9IFwiXCIrcmVzdWx0LmNoYW5nZS5sYXN0X3NlcTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRmZC5yZXNvbHZlKFwiXCIpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pLmNhdGNoKGZ1bmN0aW9uIChlcnIpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRmZC5yZWplY3QoZXJyKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KTtcblxuXG4gICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgKS5mYWlsKFxuICAgICAgICAgICAgICAgICAgICAgICBmdW5jdGlvbihlcnIpe2RmZC5yZWplY3QoZXJyKTt9XG4gICAgICAgICAgICAgICAgICk7XG5cbiAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICBlbHNle1xuXG4gICAgICAgICAgICAgICAgdGF4b25vbXlEQi5yZXBsaWNhdGUuZnJvbShuZXcgUG91Y2hEQignaHR0cDovLycgKyBDT1VDSEJBU0VfRE9NQUlOICsnOicgKyBDT1VDSEJBU0VfUE9SVCArICcvJyArIFRBWE9OT01ZX0JVQ0tFVCxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICBhamF4OiB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRpbWVvdXQ6IDYwMDAwXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfSksXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbGl2ZTogZmFsc2UsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXRyeTogdHJ1ZSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRpbWVvdXQ6IDYwMDAwXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfSlcbiAgICAgICAgICAgICAgICAudGhlbihmdW5jdGlvbiAocmVzdWx0KSB7XG4gICAgICAgICAgICAgICAgICAvL1NZTkNfU0VRID0gXCJcIityZXN1bHQuY2hhbmdlLmxhc3Rfc2VxO1xuICAgICAgICAgICAgICAgICAgZGZkLnJlc29sdmUoXCJcIik7XG4gICAgICAgICAgICAgICAgfSkuY2F0Y2goZnVuY3Rpb24gKGVycikge1xuICAgICAgICAgICAgICAgICAgZGZkLnJlamVjdChlcnIpO1xuICAgICAgICAgICAgICAgIH0pO1xuXG5cbiAgICAgICAgICAgICAgfVxuXG5cblxuICAgICAgICB9XG5cbiAgICAgICAgcmV0dXJuIGRmZC5wcm9taXNlKCk7XG4gICAgICB9LFxuXG4gICAgICBzdGFydFN5bmM6IGZ1bmN0aW9uKCkge1xuICAgICAgICB2YXIgZGZkID0gbmV3ICQuRGVmZXJyZWQoKTtcblxuICAgICAgICBkYW8uZ2V0KCdfbG9jYWwvTE9DQUxfU0VUVElOR1MnKS50aGVuKGZ1bmN0aW9uKGRhdGEpe1xuXG5cbiAgICAgICAgICAgIHZhciBzeW5jVXNlcm5hbWUgPSBMT0NBTF9TRVRUSU5HUy5TVUJTQ1JJUFRJT05TLnN5bmNVc2VybmFtZTtcbiAgICAgICAgICAgIHZhciBzeW5jUGFzc3dvcmQgPSBMT0NBTF9TRVRUSU5HUy5TVUJTQ1JJUFRJT05TLnN5bmNQYXNzd29yZDtcbiAgICAgICAgICAgIC8vIFN0YXJ0IHJlcGxpY2F0aW9uIHdpdGggYXBwbGljYXRpb25fYXBwbGljYXRpb25VVUlELCB1c2VyIHByb2ZpbGUgY2hhbm5lbCBhbmQgYWxsIHN1YnNjcmliZWQgY2hhbm5lbFxuICAgICAgICAgICAgaWYgKGhlYWQubW9iaWxlICYmIGlzQ29yZG92YUFwcCkge1xuXG5cblxuICAgICAgICAgICAgICBjb3Jkb3ZhLmV4ZWMoZnVuY3Rpb24oc2VxKXtcbiAgICAgICAgICAgICAgICBTWU5DX1NFUSA9IHNlcTtcbiAgICAgICAgICAgICAgICBkZmQucmVzb2x2ZShzZXEpO1xuXG4gICAgICAgICAgICAgIH0sIGZ1bmN0aW9uKGUpe1xuICAgICAgICAgICAgICAgIGRmZC5yZWplY3QoZSlcbiAgICAgICAgICAgICAgfSwgJ0NCTGl0ZScsICdzeW5jJyxcbiAgICAgICAgICAgICAgICBbe1wiZGJuYW1lXCI6IERCTkFNRSArIERCX0lERU5USUZJRVIsIFwidXJsXCI6J2h0dHA6Ly8nK3N5bmNVc2VybmFtZSsnOicrc3luY1Bhc3N3b3JkKydAJytDT1VDSEJBU0VfRE9NQUlOICsnOicgKyBDT1VDSEJBU0VfUE9SVCArICcvJyArIENPVUNIQkFTRV9CVUNLRVR9XVxuICAgICAgICAgICAgICApO1xuXG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICBpZihhdXRoZW50aWNhdGVkVG9TeW5jR2F0ZXdheSA9PSBmYWxzZSkge1xuICAgICAgICAgICAgICAgIGRhby5hdXRoZW50aWNhdGVUb1N5bmNHYXRld2F5KHN5bmNVc2VybmFtZSwgc3luY1Bhc3N3b3JkKS5kb25lKGZ1bmN0aW9uIChkYXRhKXtcblxuXG4gICAgICAgICAgICAgICAgICBsb2NhbERCLnN5bmMoXG4gICAgICAgICAgICAgICAgICAgIG5ldyBQb3VjaERCKCdodHRwOi8vJyArIENPVUNIQkFTRV9ET01BSU4gKyc6JyArIENPVUNIQkFTRV9QT1JUICsgJy8nICsgQ09VQ0hCQVNFX0JVQ0tFVCxcbiAgICAgICAgICAgICAgICAgICAge1xuICAgICAgICAgICAgICAgICAgICAgIGFqYXg6IHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHRpbWVvdXQ6IDYwMDAwXG4gICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICB9KSxcbiAgICAgICAgICAgICAgICAgICAge1xuICAgICAgICAgICAgICAgICAgICAgIGxpdmU6IHRydWUsXG4gICAgICAgICAgICAgICAgICAgICAgcmV0cnk6IHRydWUsXG4gICAgICAgICAgICAgICAgICAgICAgdGltZW91dDogNjAwMDBcbiAgICAgICAgICAgICAgICAgICAgfSkub24oJ2NoYW5nZScsIGZ1bmN0aW9uIChpbmZvKSB7XG5cbiAgICAgICAgICAgICAgICAgICAgICBTWU5DX1NFUSA9IFwiXCIraW5mby5jaGFuZ2UubGFzdF9zZXE7XG4gICAgICAgICAgICAgICAgICAgICAgZGZkLnJlc29sdmUoZGF0YSk7XG5cbiAgICAgICAgICAgICAgICAgICAgfSkub24oJ2FjdGl2ZScsIGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgICAgICAgICAvLyBSZXBsaWNhdGUgcmVzdW1lZCAoZS5nLiB1c2VyIHdlbnQgYmFjayBvbmxpbmUpXG5cbiAgICAgICAgICAgICAgICAgICAgfSkub24oJ2NvbXBsZXRlJywgZnVuY3Rpb24gKGluZm8pIHtcbiAgICAgICAgICAgICAgICAgICAgICAvLyBFeGVjdXRlZCB3aGVuIHRoZSBzeW5jIGhhcyBjb21wbGV0ZWQuXG5cbiAgICAgICAgICAgICAgICAgICAgfSkub24oJ2Vycm9yJywgZnVuY3Rpb24oZSl7XG4gICAgICAgICAgICAgICAgICAgICAgZGZkLnJlamVjdChlKVxuICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgfSkuZmFpbChmdW5jdGlvbihlcnIpe1xuICAgICAgICAgICAgICAgICAgZGZkLnJlamVjdChlcnIpO1xuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICB9IGVsc2Uge1xuXG5cblxuXG4gICAgICAgICAgICAgICAgbG9jYWxEQi5zeW5jKFxuICAgICAgICAgICAgICAgICAgbmV3IFBvdWNoREIoJ2h0dHA6Ly8nICsgQ09VQ0hCQVNFX0RPTUFJTiArJzonICsgQ09VQ0hCQVNFX1BPUlQgKyAnLycgKyBDT1VDSEJBU0VfQlVDS0VULFxuICAgICAgICAgICAgICAgICAge1xuICAgICAgICAgICAgICAgICAgICBhamF4OiB7XG4gICAgICAgICAgICAgICAgICAgICAgdGltZW91dDogNjAwMDBcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgfSksXG4gICAgICAgICAgICAgICAgICB7XG4gICAgICAgICAgICAgICAgICAgIGxpdmU6IHRydWUsXG4gICAgICAgICAgICAgICAgICAgIHJldHJ5OiB0cnVlLFxuICAgICAgICAgICAgICAgICAgICB0aW1lb3V0OiA2MDAwMFxuICAgICAgICAgICAgICAgIH0pLm9uKCdjaGFuZ2UnLCBmdW5jdGlvbiAoaW5mbykge1xuXG4gICAgICAgICAgICAgICAgICBTWU5DX1NFUSA9IFwiXCIraW5mby5jaGFuZ2UubGFzdF9zZXE7XG4gICAgICAgICAgICAgICAgICBkZmQucmVzb2x2ZShkYXRhKTtcblxuICAgICAgICAgICAgICAgIH0pLm9uKCdhY3RpdmUnLCBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgICAgICAvLyBSZXBsaWNhdGUgcmVzdW1lZCAoZS5nLiB1c2VyIHdlbnQgYmFjayBvbmxpbmUpXG5cbiAgICAgICAgICAgICAgICB9KS5vbignY29tcGxldGUnLCBmdW5jdGlvbiAoaW5mbykge1xuICAgICAgICAgICAgICAgICAgLy8gRXhlY3V0ZWQgd2hlbiB0aGUgc3luYyBoYXMgY29tcGxldGVkLlxuXG4gICAgICAgICAgICAgICAgfSkub24oJ2Vycm9yJyxcbiAgICAgICAgICAgICAgICAgIGZ1bmN0aW9uKGUpe2RmZC5yZWplY3QoZSlcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuXG4gICAgICAgIH0pLmZhaWwoZnVuY3Rpb24oZXJyKXtcbiAgICAgICAgICBkZmQucmVqZWN0KGVycik7XG4gICAgICAgIH0pO1xuICAgICAgICByZXR1cm4gZGZkLnByb21pc2UoKTtcbiAgICAgIH0sXG5cbiAgICAgIHN0YXJ0U3luY1RheG9ub21pZXM6IGZ1bmN0aW9uKCkge1xuXG4gICAgICAgIC8vTm8gbGl2ZSBzeW5jIGlzIHJlcXVpcmVkIGZvciB0YXhvbm9taWVzIHNvIGp1c3QgcHVsbGluZyBkaWZmZXJlbmNlcyBvbmNlIG9ubHlcbiAgICAgICAgcmV0dXJuIGRhby5wdWxsVGF4b25vbWllcygpO1xuXG5cbiAgICAgIH0sXG5cbiAgICAgIGNoYW5nZXM6IGZ1bmN0aW9uKClcbiAgICAgIHtcbiAgICAgICAgdmFyIGRmZCA9IG5ldyAkLkRlZmVycmVkKCk7XG4gICAgICAgIGlmIChoZWFkLm1vYmlsZSAmJiBpc0NvcmRvdmFBcHApIHtcblxuICAgICAgICAgICQuYWpheCh7XG4gICAgICAgICAgICAgICAgICAgIHVybDogZ2xvYmFsdXJsK0RCTkFNRSArIERCX0lERU5USUZJRVIrXCIvX2NoYW5nZXM/c2luY2U9XCIrTE9DQUxfU0VUVElOR1MuU1lOQ19TRVEsXG4gICAgICAgICAgICAgICAgICAgIHR5cGU6IFwiR0VUXCIsXG4gICAgICAgICAgICAgICAgICAgIGRhdGFUeXBlOiBcImpzb25cIixcbiAgICAgICAgICAgICAgICAgICAgc3VjY2VzczogZnVuY3Rpb24gKGRhdGEsIHRleHRTdGF0dXMsIHhocikge1xuICAgICAgICAgICAgICAgICAgICAgIGRmZC5yZXNvbHZlKGRhdGEpO1xuICAgICAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgICAgICBlcnJvcjogZnVuY3Rpb24gKHhociwgdGV4dFN0YXR1cywgZXJyb3JUaHJvd24pIHtcbiAgICAgICAgICAgICAgICAgICAgICBjb25zb2xlLmxvZyhcIkVycm9yID0gXCIrSlNPTi5zdHJpbmdpZnkoeGhyKSk7XG4gICAgICAgICAgICAgICAgICAgICAgZGZkLnJlamVjdCh4aHIucmVzcG9uc2VUZXh0KTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH0pO1xuXG4gICAgICAgIH1cbiAgICAgICAgZWxzZXtcblxuICAgICAgICAgIGxvY2FsREIuY2hhbmdlcyh7XG4gICAgICAgICAgICBzaW5jZTogcGFyc2VJbnQoTE9DQUxfU0VUVElOR1MuU1lOQ19TRVEpXG4gICAgICAgICAgfSkudGhlbihmdW5jdGlvbiAocmVzdWx0KSB7XG4gICAgICAgICAgICBkZmQucmVzb2x2ZShyZXN1bHQpO1xuICAgICAgICAgIH0pLmNhdGNoKGZ1bmN0aW9uIChlcnIpIHtcbiAgICAgICAgICAgIGRmZC5yZWplY3QoZXJyKTtcbiAgICAgICAgICB9KTtcblxuICAgICAgICB9XG5cblxuICAgICAgICByZXR1cm4gZGZkLnByb21pc2UoKTtcbiAgICAgIH0sXG5cbiAgICAgIGNyZWF0ZURhdGFiYXNlOiBmdW5jdGlvbigpXG4gICAgICB7XG4gICAgICAgIHZhciBkZmQgPSBuZXcgJC5EZWZlcnJlZCgpO1xuICAgICAgICBpZiAoaGVhZC5tb2JpbGUgJiYgaXNDb3Jkb3ZhQXBwKSB7XG5cbiAgICAgICAgICBpZiAod2luZG93LmNibGl0ZSkge1xuICAgICAgICAgICAgICAgICAgICB3aW5kb3cuY2JsaXRlLmdldFVSTChmdW5jdGlvbihlcnIsIHVybCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGVycikge1xuICAgICAgICAgICAgICAgICAgICAgICAgIGFsZXJ0KFwiZXJyb3IgbGF1bmNoaW5nIENvdWNoYmFzZSBMaXRlOiBcIiArIGVycilcbiAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgZ2xvYmFsdXJsPXVybDtcblxuICAgICAgICAgICAgICAgICAgICAgICAgIC8vdGhpcyBpcyBhIGhhY2sgZm9yIGFuZHJvaWQgdmVyc2lvbiA0LjEgYnVnXG4gICAgICAgICAgICAgICAgICAgICAgICAgdHJ5e1xuICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgeG1sSHR0cCA9IG5ldyBYTUxIdHRwUmVxdWVzdCgpO1xuICAgICAgICAgICAgICAgICAgICAgICAgeG1sSHR0cC5vcGVuKCAnR0VUJywgZ2xvYmFsdXJsLCBmYWxzZSApO1xuICAgICAgICAgICAgICAgICAgICAgICAgeG1sSHR0cC5zZW5kKCBudWxsICk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgfWNhdGNoKGUpe1xuXG4gICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgIC8vLy8vLy8vLy8vLy8vLy8vLy8vLy9cblxuXG4gICAgICAgICAgICAgICAgICAgICAgICAkLmFqYXgoe1xuICAgICAgICAgICAgICAgICAgICAgICAgIHVybDogZ2xvYmFsdXJsK0RCTkFNRSArIFwibWFzdGVyXCIsXG4gICAgICAgICAgICAgICAgICAgICAgICAgdHlwZTogXCJQVVRcIixcbiAgICAgICAgICAgICAgICAgICAgICAgICBkYXRhOiAgXCJcIixcbiAgICAgICAgICAgICAgICAgICAgICAgICBkYXRhVHlwZTogXCJqc29uXCIsXG4gICAgICAgICAgICAgICAgICAgICAgICAgY29udGVudFR5cGU6IFwiYXBwbGljYXRpb24vanNvblwiLFxuICAgICAgICAgICAgICAgICAgICAgICAgIHN1Y2Nlc3M6IGZ1bmN0aW9uIChkYXRhLCB0ZXh0U3RhdHVzLCB4aHIpIHtcblxuICAgICAgICAgICAgICAgICAgICAgICAgIGlmKHhoci5zdGF0dXMgPT0gMjAxIHx8IHhoci5zdGF0dXMgPT0gNDEyKVxuICAgICAgICAgICAgICAgICAgICAgICAgICAge1xuXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICBkYW8uZ2V0SWRlbnRpZmllcigpXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLmRvbmUoZnVuY3Rpb24oaWQpe1xuXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgREJfSURFTlRJRklFUiA9IGlkO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRhby5jcmVhdGVEYXRhYmFzZUltcGwoZGZkKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC5mYWlsKGZ1bmN0aW9uKGUpe1xuXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgREJfSURFTlRJRklFUiA9IGdlbmVyYXRlVVVJRCgpLnN1YnN0cmluZygwLDgpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRhby5zYXZlSWRlbnRpZmllcigpXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLmRvbmUoZnVuY3Rpb24ocyl7ZGFvLmNyZWF0ZURhdGFiYXNlSW1wbChkZmQpO30pO1xuXG5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgZWxzZVxuICAgICAgICAgICAgICAgICAgICAgICAgICAge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRmZC5yZWplY3QoeGhyLnJlc3BvbnNlVGV4dCk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICAgICAgICAgICBlcnJvcjogZnVuY3Rpb24gKHhociwgdGV4dFN0YXR1cywgZXJyb3JUaHJvd24pIHtcblxuICAgICAgICAgICAgICAgICAgICAgICAgIGlmKHhoci5zdGF0dXMgPT0gMjAxIHx8IHhoci5zdGF0dXMgPT0gNDEyKVxuICAgICAgICAgICAgICAgICAgICAgICAgICAge1xuXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZGFvLmdldElkZW50aWZpZXIoKVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC5kb25lKGZ1bmN0aW9uKGlkKXtcblxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIERCX0lERU5USUZJRVIgPSBpZDtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBkYW8uY3JlYXRlRGF0YWJhc2VJbXBsKGRmZCk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSlcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAuZmFpbChmdW5jdGlvbihlKXtcblxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIERCX0lERU5USUZJRVIgPSBnZW5lcmF0ZVVVSUQoKS5zdWJzdHJpbmcoMCw4KTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBkYW8uc2F2ZUlkZW50aWZpZXIoKVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC5kb25lKGZ1bmN0aW9uKHMpe2Rhby5jcmVhdGVEYXRhYmFzZUltcGwoZGZkKTt9KTtcblxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICAgICBlbHNlXG4gICAgICAgICAgICAgICAgICAgICAgICAgICB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgZGZkLnJlamVjdCh4aHIucmVzcG9uc2VUZXh0KTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICBhbGVydChcImVycm9yLCBDb3VjaGJhc2UgTGl0ZSBwbHVnaW4gbm90IGZvdW5kLlwiKVxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICBlbHNle1xuICAgICAgICAgIG5ldyBQb3VjaERCKERCTkFNRStcIm1hc3RlclwiKVxuICAgICAgICAgIC50aGVuKGZ1bmN0aW9uICh0bXBEYil7XG4gICAgICAgICAgICAgbWFzdGVyREIgPSB0bXBEYjtcbiAgICAgICAgICAgICBkYW8uZ2V0SWRlbnRpZmllcigpXG4gICAgICAgICAgICAgLmRvbmUoZnVuY3Rpb24oaWQpe1xuXG4gICAgICAgICAgICAgICAgREJfSURFTlRJRklFUiA9IGlkO1xuICAgICAgICAgICAgICAgIGRhby5jcmVhdGVEYXRhYmFzZUltcGwoZGZkKTtcbiAgICAgICAgICAgICB9KVxuICAgICAgICAgICAgIC5mYWlsKGZ1bmN0aW9uKGUpe1xuXG4gICAgICAgICAgICAgICAgREJfSURFTlRJRklFUiA9IGdlbmVyYXRlVVVJRCgpLnN1YnN0cmluZygwLDgpO1xuICAgICAgICAgICAgICAgIGRhby5zYXZlSWRlbnRpZmllcigpXG4gICAgICAgICAgICAgICAgLmRvbmUoZnVuY3Rpb24ocyl7ZGFvLmNyZWF0ZURhdGFiYXNlSW1wbChkZmQpO30pO1xuXG4gICAgICAgICAgICAgfSk7XG5cblxuICAgICAgICAgIH0pO1xuXG5cbiAgICAgICAgfVxuXG4gICAgICAgIHJldHVybiBkZmQucHJvbWlzZSgpO1xuICAgICAgfSxcblxuICAgICAgY3JlYXRlRGF0YWJhc2VJbXBsOiBmdW5jdGlvbihkZmQpXG4gICAgICB7XG5cbiAgICAgICAgaWYgKGhlYWQubW9iaWxlICYmIGlzQ29yZG92YUFwcCkge1xuXG5cbiAgICAgICAgICAgICAkLmFqYXgoe1xuICAgICAgICAgICAgIHVybDogZ2xvYmFsdXJsK1RBWE9OT01ZX0RCTkFNRSArIERCX0lERU5USUZJRVIsXG4gICAgICAgICAgICAgdHlwZTogXCJQVVRcIixcbiAgICAgICAgICAgICBkYXRhOiAgXCJcIixcbiAgICAgICAgICAgICBkYXRhVHlwZTogXCJqc29uXCIsXG4gICAgICAgICAgICAgY29udGVudFR5cGU6IFwiYXBwbGljYXRpb24vanNvblwiLFxuICAgICAgICAgICAgIHN1Y2Nlc3M6IGZ1bmN0aW9uIChkYXRhLCB0ZXh0U3RhdHVzLCB4aHIpIHtcblxuXG4gICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICBlcnJvcjogZnVuY3Rpb24gKHhociwgdGV4dFN0YXR1cywgZXJyb3JUaHJvd24pIHtcblxuXG5cbiAgICAgICAgICAgICB9XG4gICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICAkLmFqYXgoe1xuICAgICAgICAgICAgIHVybDogZ2xvYmFsdXJsK0RCTkFNRSArIERCX0lERU5USUZJRVIsXG4gICAgICAgICAgICAgdHlwZTogXCJQVVRcIixcbiAgICAgICAgICAgICBkYXRhOiAgXCJcIixcbiAgICAgICAgICAgICBkYXRhVHlwZTogXCJqc29uXCIsXG4gICAgICAgICAgICAgY29udGVudFR5cGU6IFwiYXBwbGljYXRpb24vanNvblwiLFxuICAgICAgICAgICAgIHN1Y2Nlc3M6IGZ1bmN0aW9uIChkYXRhLCB0ZXh0U3RhdHVzLCB4aHIpIHtcblxuICAgICAgICAgICAgIGlmKHhoci5zdGF0dXMgPT0gMjAxIHx8IHhoci5zdGF0dXMgPT0gNDEyKVxuICAgICAgICAgICAgICAge1xuICAgICAgICAgICAgICAgICBkZmQucmVzb2x2ZShkYXRhKTtcbiAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgIGVsc2VcbiAgICAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgICBkZmQucmVqZWN0KHhoci5yZXNwb25zZVRleHQpO1xuICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgZXJyb3I6IGZ1bmN0aW9uICh4aHIsIHRleHRTdGF0dXMsIGVycm9yVGhyb3duKSB7XG5cbiAgICAgICAgICAgICBpZih4aHIuc3RhdHVzID09IDIwMSB8fCB4aHIuc3RhdHVzID09IDQxMilcbiAgICAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgICAgZGZkLnJlc29sdmUoeGhyLnJlc3BvbnNlVGV4dCk7XG4gICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICBlbHNlXG4gICAgICAgICAgICAgICB7XG4gICAgICAgICAgICAgICAgZGZkLnJlamVjdCh4aHIucmVzcG9uc2VUZXh0KTtcbiAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgIH1cbiAgICAgICAgICAgfSk7XG5cbiAgICAgICAgfVxuICAgICAgICBlbHNle1xuICAgICAgICAgIG5ldyBQb3VjaERCKFRBWE9OT01ZX0RCTkFNRSArIERCX0lERU5USUZJRVIpXG4gICAgICAgICAgLnRoZW4oZnVuY3Rpb24gKHRtcERiKXtcbiAgICAgICAgICAgICB0YXhvbm9teURCID0gdG1wRGI7XG5cbiAgICAgICAgICAgICBuZXcgUG91Y2hEQihEQk5BTUUgKyBEQl9JREVOVElGSUVSKVxuICAgICAgICAgICAgICAudGhlbihmdW5jdGlvbiAodG1wRGIpe1xuICAgICAgICAgICAgICAgICBsb2NhbERCID0gdG1wRGI7XG4gICAgICAgICAgICAgICAgIGRmZC5yZXNvbHZlKCdEYXRhYmFzZSBjcmVhdGVkJyk7XG4gICAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgfSk7XG5cblxuICAgICAgICB9XG5cbiAgICAgIH0sXG5cbiAgICAgIGRlbGV0ZURvY3VtZW50IDpmdW5jdGlvbihkb2NJZCl7XG5cbiAgICAgICAgdmFyIGRmZCA9IG5ldyAkLkRlZmVycmVkKCk7XG4gICAgICAgIGlmIChoZWFkLm1vYmlsZSAmJiBpc0NvcmRvdmFBcHApIHtcblxuXG4gICAgICAgICAgLy8gY29yZG92YS5leGVjKGZ1bmN0aW9uKGRhdGEpe1xuXG4gICAgICAgICAgLy8gICBkZmQucmVzb2x2ZShkYXRhKTtcblxuICAgICAgICAgIC8vIH0sIGZ1bmN0aW9uKGUpe1xuICAgICAgICAgIC8vICAgZGZkLnJlamVjdChlKVxuICAgICAgICAgIC8vIH0sICdDQkxpdGUnLCAnZGVsZXRlRG9jdW1lbnQnLFxuICAgICAgICAgIC8vICAgW3tcImRibmFtZVwiOiBEQk5BTUUgKyBEQl9JREVOVElGSUVSLCBcImRvY0lkXCI6IGRvYy5faWQsIFwicmV2XCI6ZG9jLl9yZXZ9XVxuICAgICAgICAgIC8vICk7XG5cbiAgICAgICAgICB2YXIgc0NCPWZ1bmN0aW9uKGRvYyl7XG5cbiAgICAgICAgICAgICAgICAkLmFqYXgoe1xuICAgICAgICAgICAgICAgICAgICB1cmw6IGdsb2JhbHVybCtEQk5BTUUgKyBEQl9JREVOVElGSUVSK1wiL1wiK2RvYy5faWQrXCI/cmV2PVwiK2RvYy5fcmV2LFxuICAgICAgICAgICAgICAgICAgICB0eXBlOiBcIkRFTEVURVwiLFxuICAgICAgICAgICAgICAgICAgICBkYXRhOiBKU09OLnN0cmluZ2lmeShkb2MpLFxuICAgICAgICAgICAgICAgICAgICBkYXRhVHlwZTogXCJqc29uXCIsXG4gICAgICAgICAgICAgICAgICAgIGNvbnRlbnRUeXBlOiBcImFwcGxpY2F0aW9uL2pzb25cIixcbiAgICAgICAgICAgICAgICAgICAgc3VjY2VzczogZnVuY3Rpb24gKGRhdGEsIHRleHRTdGF0dXMsIHhocikge1xuICAgICAgICAgICAgICAgICAgICAgIGRmZC5yZXNvbHZlKGRhdGEpO1xuICAgICAgICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgICAgICAgZXJyb3I6IGZ1bmN0aW9uICh4aHIsIHRleHRTdGF0dXMsIGVycm9yVGhyb3duKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBkZmQucmVqZWN0KHhoci5yZXNwb25zZVRleHQpO1xuICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICB9XG5cblxuICAgICAgICAgICAgICBkYW8uZ2V0KGRvY0lkKVxuICAgICAgICAgICAgICAuZG9uZShzQ0IpXG4gICAgICAgICAgICAgIC5mYWlsKGZ1bmN0aW9uKGUpe2RmZC5yZWplY3QoZSl9KTtcblxuICAgICAgICB9XG4gICAgICAgIGVsc2V7XG5cbiAgICAgICAgICBsb2NhbERCLmdldChkb2NJZCkudGhlbihmdW5jdGlvbihkb2MpIHtcbiAgICAgICAgICAgIHJldHVybiBsb2NhbERCLnJlbW92ZShkb2MpO1xuICAgICAgICAgIH0pLnRoZW4oZnVuY3Rpb24gKHJlc3VsdCkge1xuICAgICAgICAgICAgZGZkLnJlc29sdmUocmVzdWx0KTtcbiAgICAgICAgICB9KS5jYXRjaChmdW5jdGlvbiAoZXJyKSB7XG4gICAgICAgICAgICBkZmQucmVqZWN0KGVycik7XG4gICAgICAgICAgfSk7XG5cbiAgICAgICAgfVxuXG4gICAgICAgIHJldHVybiBkZmQucHJvbWlzZSgpO1xuICAgICAgICAgfSxcblxuICAgICAgICAgcmVzZXREYXRhYmFzZSA6ZnVuY3Rpb24oKXtcblxuXG4gICAgICAgICAgICB2YXIgZGZkID0gbmV3ICQuRGVmZXJyZWQoKTtcblxuICAgICAgICAgICAgdmFyIF9EQl9JREVOVElGSUVSID0gREJfSURFTlRJRklFUjtcbiAgICAgICAgICAgIERCX0lERU5USUZJRVIgPSBnZW5lcmF0ZVVVSUQoKS5zdWJzdHJpbmcoMCw4KTtcbiAgICAgICAgICAgIGRhby5zYXZlSWRlbnRpZmllcigpXG4gICAgICAgICAgICAuZG9uZShmdW5jdGlvbihzKXtcblxuICAgICAgICAgICAgICAgIGlmIChoZWFkLm1vYmlsZSAmJiBpc0NvcmRvdmFBcHApIHtcblxuICAgICAgICAgICAgICAgICAgICAgICAkLmFqYXgoe1xuICAgICAgICAgICAgICAgICAgICAgICAgICB1cmw6IGdsb2JhbHVybCtUQVhPTk9NWV9EQk5BTUUgKyBfREJfSURFTlRJRklFUixcbiAgICAgICAgICAgICAgICAgICAgICAgICAgdHlwZTogXCJERUxFVEVcIixcbiAgICAgICAgICAgICAgICAgICAgICAgICAgIHN1Y2Nlc3M6IGZ1bmN0aW9uIChkYXRhLCB0ZXh0U3RhdHVzLCB4aHIpIHtcblxuXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAkLmFqYXgoe1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHVybDogZ2xvYmFsdXJsK0RCTkFNRSArIF9EQl9JREVOVElGSUVSLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHR5cGU6IFwiREVMRVRFXCIsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHN1Y2Nlc3M6IGZ1bmN0aW9uIChkYXRhLCB0ZXh0U3RhdHVzLCB4aHIpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZGFvLmNyZWF0ZURhdGFiYXNlKCkuZG9uZShcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbmV3IGZ1bmN0aW9uKHMpe1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRmZC5yZXNvbHZlKGRhdGEpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICkuZmFpbChmdW5jdGlvbihlcnIpe1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBkZmQucmVzb2x2ZShlcnIpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBlcnJvcjogZnVuY3Rpb24gKHhociwgdGV4dFN0YXR1cywgZXJyb3JUaHJvd24pIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZGZkLnJlc29sdmUoeGhyLnJlc3BvbnNlVGV4dCk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KTtcblxuXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBlcnJvcjogZnVuY3Rpb24gKHhociwgdGV4dFN0YXR1cywgZXJyb3JUaHJvd24pIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRmZC5yZXNvbHZlKHhoci5yZXNwb25zZVRleHQpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICB9KTtcblxuXG5cbiAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICBlbHNle1xuXG5cbiAgICAgICAgICAgICAgICAgdGF4b25vbXlEQi5kZXN0cm95KCkudGhlbihmdW5jdGlvbiAocmVzcG9uc2UpIHtcblxuICAgICAgICAgICAgICAgICAgICAgIGxvY2FsREIuZGVzdHJveSgpLnRoZW4oZnVuY3Rpb24gKHJlc3BvbnNlKSB7XG5cbiAgICAgICAgICAgICAgICAgICAgICAgICBkYW8uY3JlYXRlRGF0YWJhc2UoKS5kb25lKFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIG5ldyBmdW5jdGlvbihzKXtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRmZC5yZXNvbHZlKHMpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgICApLmZhaWwoZnVuY3Rpb24oZXJyKXtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBkZmQucmVqZWN0KGVycik7XG4gICAgICAgICAgICAgICAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICAgICAgICAgICAgfSkuY2F0Y2goZnVuY3Rpb24gKGVycikge1xuXG4gICAgICAgICAgICAgICAgICAgICAgICAgZGZkLnJlamVjdChlcnIpO1xuICAgICAgICAgICAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICAgICAgICAgICAgfSkuY2F0Y2goZnVuY3Rpb24gKGVycikge1xuXG4gICAgICAgICAgICAgICAgICAgICAgICBkZmQucmVqZWN0KGVycik7XG5cbiAgICAgICAgICAgICAgICAgICAgICB9KTtcblxuXG4gICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIH0pO1xuXG5cblxuICAgICAgICAgICAgcmV0dXJuIGRmZC5wcm9taXNlKCk7XG4gICAgICAgIH0sXG5cbiAgICAgIGNyZWF0ZURvY1ZpZXcgOiBmdW5jdGlvbihkb2NWaWV3SWQsIHZpZXdMb2dpYyl7XG5cbiAgICAgIHZhciBkZmQgPSBuZXcgJC5EZWZlcnJlZCgpO1xuXG4gICAgICB2aWV3TG9naWNbXCJfaWRcIl09XCJfZGVzaWduL1wiK2RvY1ZpZXdJZDtcblxuICAgICAgZGFvLnVwc2VydCh2aWV3TG9naWMpLmRvbmUoZnVuY3Rpb24oZGF0YSl7IGRmZC5yZXNvbHZlKGRhdGEpfSkuZmFpbChmdW5jdGlvbihlKXtkZmQucmVqZWN0KGUpfSk7XG5cbiAgICAgIHJldHVybiBkZmQucHJvbWlzZSgpO1xuICAgICAgIH0sXG5cbiAgICBnZXRJZGVudGlmaWVyOiBmdW5jdGlvbigpe1xuXG4gICAgICB2YXIgZGZkID0gbmV3ICQuRGVmZXJyZWQoKTtcbiAgICAgIHRyeXtcbiAgICAgICAvL2NvbnNvbGUubG9nKFwiRmV0Y2hpbmcgb2JqZWN0ID09IFwiK2RvY0lkKTtcblxuICAgICAgaWYgKGhlYWQubW9iaWxlICYmIGlzQ29yZG92YUFwcCkge1xuXG4gICAgICAgIHZhciBvcHRpb25zID0ge1xuICAgICAgICAgIHVybDogZ2xvYmFsdXJsICsgREJOQU1FICsgXCJtYXN0ZXJcIiArIFwiL1wiICsgXCJfbG9jYWwvU0VUVElOR1NcIixcbiAgICAgICAgICAgICAgICAgIHR5cGU6IFwiR0VUXCIsXG4gICAgICAgICAgICAgICAgICBkYXRhVHlwZTogXCJqc29uXCJcbiAgICAgICAgfTtcblxuXG4gICAgICAgICQuYWpheChvcHRpb25zKVxuICAgICAgICAuZG9uZShmdW5jdGlvbihkYXRhLCB0ZXh0U3RhdHVzLCB4aHIpe1xuXG4gICAgICAgICAgZGZkLnJlc29sdmUoZGF0YS5EQl9JREVOVElGSUVSKTtcbiAgICAgICAgfSlcbiAgICAgICAgLmZhaWwoZnVuY3Rpb24oeGhyLCB0ZXh0U3RhdHVzLCBlcnJvclRocm93bil7XG5cbiAgICAgICAgICBkZmQucmVqZWN0KHhocik7XG4gICAgICAgIH0pO1xuXG4gICAgICB9IGVsc2Uge1xuXG4gICAgICAgICBtYXN0ZXJEQi5nZXQoXCJfbG9jYWwvU0VUVElOR1NcIilcbiAgICAgICAgICAudGhlbihmdW5jdGlvbihkYXRhKXtcbiAgICAgICAgICAgIGRmZC5yZXNvbHZlKGRhdGEuREJfSURFTlRJRklFUik7XG4gICAgICAgICAgfSkuY2F0Y2goZnVuY3Rpb24oZXJyKXtcblxuICAgICAgICAgICAgZGZkLnJlamVjdChlcnIpO1xuICAgICAgICAgICAgcmV0dXJuIGVycjtcbiAgICAgICAgICB9KTtcblxuICAgICAgfVxuICAgICAgfWNhdGNoKGUpXG4gICAgICB7XG4gICAgICAgIGRmZC5yZWplY3QoZSk7XG4gICAgICB9XG4gICAgICByZXR1cm4gZGZkLnByb21pc2UoKTtcblxuXG4gICAgfSxcbiAgICBzYXZlSWRlbnRpZmllcjogZnVuY3Rpb24oKXtcblxuICAgICAgdmFyIGRvY3VtZW50ID0ge1wiREJfSURFTlRJRklFUlwiOiBEQl9JREVOVElGSUVSLCBcIl9pZFwiOlwiX2xvY2FsL1NFVFRJTkdTXCJ9O1xuXG4gICAgICAgdmFyIGRmZCA9IG5ldyAkLkRlZmVycmVkKCk7XG5cbiAgICAgICB2YXIgc3YgPSBmdW5jdGlvbihkb2Mpe1xuXG4gICAgICAgICAgICBpZiAoaGVhZC5tb2JpbGUgJiYgaXNDb3Jkb3ZhQXBwKSB7XG5cbiAgICAgICAgICAgICAgdmFyIG9wdGlvbnMgPSB7XG4gICAgICAgICAgICAgICAgdXJsOiBnbG9iYWx1cmwgKyBEQk5BTUUgKyBcIm1hc3RlclwiICsgXCIvXCIgKyBcIl9sb2NhbC9TRVRUSU5HU1wiLFxuICAgICAgICAgICAgICAgICAgICAgICAgdHlwZTogXCJQVVRcIixcbiAgICAgICAgICAgICAgICAgICAgICAgIGRhdGE6ICBKU09OLnN0cmluZ2lmeShkb2MpLFxuICAgICAgICAgICAgICAgICAgICAgICAgZGF0YVR5cGU6IFwianNvblwiLFxuICAgICAgICAgICAgICAgICAgICAgICAgY29udGVudFR5cGU6IFwiYXBwbGljYXRpb24vanNvblwiXG4gICAgICAgICAgICAgIH07XG5cbiAgICAgICAgICAgICAgJC5hamF4KG9wdGlvbnMpXG4gICAgICAgICAgICAgIC5kb25lKGZ1bmN0aW9uKGRhdGEsIHRleHRTdGF0dXMsIHhocil7XG4gICAgICAgICAgICAgICAgZGZkLnJlc29sdmUoZGF0YSk7XG4gICAgICAgICAgICAgIH0pXG4gICAgICAgICAgICAgIC5mYWlsKGZ1bmN0aW9uKHhociwgdGV4dFN0YXR1cywgZXJyb3JUaHJvd24pe1xuXG4gICAgICAgICAgICAgICAgZGZkLnJlamVjdCh4aHIucmVzcG9uc2VUZXh0KTtcbiAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB9IGVsc2Uge1xuXG4gICAgICAgICAgICAgIG1hc3RlckRCLnB1dChkb2MpXG4gICAgICAgICAgICAgIC50aGVuKGZ1bmN0aW9uKGRhdGEpe1xuICAgICAgICAgICAgICAgIGRmZC5yZXNvbHZlKGRhdGEpO1xuICAgICAgICAgICAgICB9KS5jYXRjaChmdW5jdGlvbihlcnIpe1xuXG4gICAgICAgICAgICAgICAgZGZkLnJlamVjdChlcnIpO1xuICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIH1cblxuICAgICAgIH07XG5cblxuICAgICAgdmFyIHNDQiA9IGZ1bmN0aW9uKGRvYyl7XG5cbiAgICAgICAgZG9jdW1lbnQuX3JldiA9IGRvYy5fcmV2O1xuXG4gICAgICAgIHN2KGRvY3VtZW50KTtcblxuICAgICAgfVxuXG4gICAgICB2YXIgZUNCID0gZnVuY3Rpb24oZXJyKXtcbiAgICAgICAgc3YoZG9jdW1lbnQpO1xuICAgICAgfVxuXG5cblxuXG4gICAgICBpZiAoaGVhZC5tb2JpbGUgJiYgaXNDb3Jkb3ZhQXBwKSB7XG5cbiAgICAgICAgdmFyIG9wdGlvbnMgPSB7XG4gICAgICAgICAgdXJsOiBnbG9iYWx1cmwgKyBEQk5BTUUgKyBcIm1hc3RlclwiICsgXCIvXCIgKyBcIl9sb2NhbC9TRVRUSU5HU1wiLFxuICAgICAgICAgICAgICAgICAgdHlwZTogXCJHRVRcIixcbiAgICAgICAgICAgICAgICAgIGRhdGFUeXBlOiBcImpzb25cIlxuICAgICAgICB9O1xuXG5cbiAgICAgICAgJC5hamF4KG9wdGlvbnMpXG4gICAgICAgIC5kb25lKHNDQilcbiAgICAgICAgLmZhaWwoZUNCKTtcblxuICAgICAgfSBlbHNlIHtcblxuICAgICAgICAgbWFzdGVyREIuZ2V0KFwiX2xvY2FsL1NFVFRJTkdTXCIpXG4gICAgICAgICAgLnRoZW4oc0NCKS5jYXRjaChlQ0IpO1xuXG4gICAgICB9XG4gICAgICByZXR1cm4gZGZkLnByb21pc2UoKTtcblxuXG4gICAgfSxcbiAgICBnZXREb2NWaWV3OiBmdW5jdGlvbihkb2NWaWV3SWRzLCB2aWV3TmFtZSwgb3B0cyl7XG4gICAgICAgIHZhciBkZmQgPSBuZXcgJC5EZWZlcnJlZCgpO1xuICAgICAgICB0cnl7XG4gICAgICAgIC8vICxsaW1pdCwgc2tpcCBza2lwIGFuZCB0b3RhbCBubyBvZiByZWNvcmQgc2hvdWxkIG5vdCBiZSBlcXVhbFxuICAgICAgICB2YXIgZGVzYyA9IGZhbHNlO1xuICAgICAgICBpZihvcHRzICE9IHVuZGVmaW5lZCAmJiBvcHRzLmRlc2NlbmRpbmcgIT0gdW5kZWZpbmVkKVxuICAgICAgICB7XG4gICAgICAgICAgZGVzYyA9IG9wdHMuZGVzY2VuZGluZztcbiAgICAgICAgfVxuICAgICAgICBpZiAoaGVhZC5tb2JpbGUgJiYgaXNDb3Jkb3ZhQXBwKSB7XG4gICAgICAgICAgICB2YXIgcGFyYW1zID0gJz9pbmNsdWRlX2RvY3M9dHJ1ZSZrZXk9JyArIG9wdHMua2V5ICsgJyZsaW1pdD0nICsgb3B0cy5wYWdlU2l6ZVZhbCArICcmc2l6ZT0nICsgKG9wdHMucGFnZUluZGV4VmFsICogb3B0cy5wYWdlU2l6ZVZhbCkgKyAnJmRlc2NlbmRpbmc9JyArIGRlc2M7XG4gICAgICAgICAgICAkLmFqYXgoe1xuICAgICAgICAgICAgICAgIHVybDogZ2xvYmFsdXJsK0RCTkFNRSArIERCX0lERU5USUZJRVIrXCIvX2Rlc2lnbi9cIitkb2NWaWV3SWRzK1wiL192aWV3L1wiK3ZpZXdOYW1lICsgcGFyYW1zLFxuICAgICAgICAgICAgICAgIHR5cGU6IFwiR0VUXCIsXG4gICAgICAgICAgICAgICAgZGF0YVR5cGU6IFwianNvblwiLFxuICAgICAgICAgICAgICAgIHN1Y2Nlc3M6IGZ1bmN0aW9uIChkYXRhLCB0ZXh0U3RhdHVzLCB4aHIpIHtcblxuICAgICAgICAgICAgICAgICAgICBkZmQucmVzb2x2ZShkYXRhKTtcbiAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgIGVycm9yOiBmdW5jdGlvbiAoeGhyLCB0ZXh0U3RhdHVzLCBlcnJvclRocm93bikge1xuICAgICAgICAgICAgICAgICAgICBjb25zb2xlLmxvZyhcImVycm9yIG9jY3VyZWQgd2hpbGUgZ2V0dGluZyBkb2MgdmlldyBcIitKU09OLnN0cmluZ2lmeSh4aHIpKTtcbiAgICAgICAgICAgICAgICAgICAgZGZkLnJlamVjdCh4aHIucmVzcG9uc2VUZXh0KTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIGxvY2FsREIucXVlcnkoZG9jVmlld0lkcytcIi9cIit2aWV3TmFtZSx7XG4gICAgICAgICAgICAgICAgaW5jbHVkZV9kb2NzOiB0cnVlLFxuICAgICAgICAgICAgICAgIGtleTogb3B0cy5rZXksXG4gICAgICAgICAgICAgICAgbGltaXQ6IG9wdHMucGFnZVNpemVWYWwsXG4gICAgICAgICAgICAgICAgc2tpcDogb3B0cy5wYWdlSW5kZXhWYWwgKiBvcHRzLnBhZ2VTaXplVmFsLFxuICAgICAgICAgICAgICAgIGRlc2NlbmRpbmc6IGRlc2NcbiAgICAgICAgICAgIH0pLnRoZW4oZnVuY3Rpb24gKHJlcykge1xuICAgICAgICAgICAgICAgIGRmZC5yZXNvbHZlKHJlcyk7XG4gICAgICAgICAgICB9KS5jYXRjaChmdW5jdGlvbiAoZXJyKSB7XG4gICAgICAgICAgICAgICAgY29uc29sZS5sb2coZXJyKTtcbiAgICAgICAgICAgICAgICBkZmQucmVqZWN0KGVycik7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfVxuICAgICAgICB9Y2F0Y2goZSlcbiAgICAgIHtcbiAgICAgICAgZGZkLnJlamVjdChlKTtcbiAgICAgIH1cbiAgICAgICAgcmV0dXJuIGRmZC5wcm9taXNlKCk7XG4gICAgfSxcblxuICAgIHNlYXJjaDogZnVuY3Rpb24oY2F0ZWdvcmllcywgdGV4dClcbiAgICB7XG5cbiAgICAgIHZhciBkZmQgPSBuZXcgJC5EZWZlcnJlZCgpO1xuXG4gICAgICB2YXIgdmlld05hbWU9XCJ2aWV3X3NlYXJjaERhdGFcIjtcbiAgICAgIHZhciBkb2NJZD1nZW5lcmF0ZVVVSUQoKTtcbiAgICAgIHZhciBWSUVXX1NFQVJDSD17XG4gICAgICAgICAgXCJsYW5ndWFnZVwiIDogXCJqYXZhc2NyaXB0XCIsXG4gICAgICAgICAgICBcInZpZXdzXCIgOiB7XG4gICAgICAgICAgICAgIFwidmlld19zZWFyY2hEYXRhXCIgOiB7XG4gICAgICAgICAgICAgICAgICAgIFwibWFwXCIgOiBcImZ1bmN0aW9uKGRvYykge1wiICtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgXCJ2YXIgc2VhcmNoYWJsZUNhdGVnb3JpZXMgPSBKU09OLnBhcnNlKCdcIiArIEpTT04uc3RyaW5naWZ5KGNhdGVnb3JpZXMpICtcIicpO1wiICtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgXCJpZih0eXBlb2YgKGRvYy50aXRsZSkgIT0gJ3VuZGVmaW5lZCcgXCIgK1xuICAgICAgICAgICAgICAgICAgICAgICAgICBcIiYmIHR5cGVvZiAoZG9jLmNhdGVnb3J5KSAhPSAndW5kZWZpbmVkJyBcIiArXG4gICAgICAgICAgICAgICAgICAgICAgICAgIFwiJiYgdHlwZW9mIChkb2MuY2F0ZWdvcnkudGVybSkgIT0gJ3VuZGVmaW5lZCcpe1wiICtcblxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIFwiaWYoc2VhcmNoYWJsZUNhdGVnb3JpZXMuaW5kZXhPZihkb2MuY2F0ZWdvcnkudGVybSkgPiAtMSl7XCIgK1xuXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgXCJ2YXIgZG9jVGl0bGUgPSBkb2MudGl0bGUudG9Mb3dlckNhc2UoKTtcIiArXG5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBcImlmKCAoZG9jLmNhdGVnb3J5LnRlcm0gPT0gJ3BhcnRpY2lwYW50JyAmJiBkb2MuX2lkLnRvTG93ZXJDYXNlKCkuaW5kZXhPZignXCIrdGV4dC50b0xvd2VyQ2FzZSgpK1wiJykgPiAtMSkgfHwgZG9jVGl0bGUuaW5kZXhPZignXCIrdGV4dC50b0xvd2VyQ2FzZSgpK1wiJykgPiAtMSkge1wiICtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBcIiAgdmFyIGpzb25PYmogPSBkb2M7IGVtaXQoZG9jLnRpdGxlLnRvVXBwZXJDYXNlKCksICBqc29uT2JqICk7IFwiICtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFwifVwiICtcblxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIFwifVwiK1xuXG4gICAgICAgICAgICAgICAgICAgICAgICAgIFwifVwiICtcbiAgICAgICAgICAgICAgICAgICAgICAgIFwifVwiXG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICB9O1xuXG5cbiAgICAgIHZhciBzdWNjZXNzU2VhcmNoVmlldz1mdW5jdGlvbihkb2Mpe1xuXG5cbiAgICAgICAgIHNldFRpbWVvdXQoZnVuY3Rpb24oKXtcblxuICAgICAgICAgIHZhciBvcHRpb25zID0ge1xuICAgICAgICAgICAgcGFnZVNpemVWYWw6IDUwLFxuICAgICAgICAgICAgcGFnZUluZGV4VmFsOiAwLFxuICAgICAgICAgICAgaW5jbHVkZV9kb2NzOiB0cnVlXG4gICAgICAgICAgfVxuXG4gICAgICAgICAgZGFvLmdldERvY1ZpZXcoZG9jSWQsIHZpZXdOYW1lLCBvcHRpb25zKVxuICAgICAgICAgIC5kb25lKGZ1bmN0aW9uKGRhdGEpe1xuICAgICAgICAgICAgZGZkLnJlc29sdmUoZGF0YSk7XG4gICAgICAgICAgfSkuZmFpbChmdW5jdGlvbihlcnIpe1xuICAgICAgICAgICAgZGZkLnJlamVjdChlcnIpO1xuICAgICAgICAgIH0pO1xuXG4gICAgICAgICB9LCAxMDAwKTtcblxuICAgICAgfTtcblxuXG4gICAgICBkYW8uY3JlYXRlRG9jVmlldyhkb2NJZCxWSUVXX1NFQVJDSClcbiAgICAgIC5kb25lKHN1Y2Nlc3NTZWFyY2hWaWV3KVxuICAgICAgLmZhaWwoZnVuY3Rpb24oZXJyKXtkZmQucmVqZWN0KGVycik7fSk7XG5cblxuICAgICAgcmV0dXJuIGRmZC5wcm9taXNlKCk7XG4gICAgfSxcblxuICAgIHByb2ZpbGVEYXRhOiBmdW5jdGlvbihjYXRlZ29yeSwgcHJvZmlsZUlkKXtcblxuXG4gICAgICB2YXIgZGVmZmVyZWQgPSBuZXcgJC5EZWZlcnJlZCgpO1xuXG4gICAgICB2YXIgdmlld05hbWU9XCJ2aWV3X3NlYXJjaERhdGFcIjtcbiAgICAgIHZhciBkb2NJZD1cIlNlYXJjaFwiK2NhdGVnb3J5K3Byb2ZpbGVJZDtcblxuICAgICAgdmFyIG9wdGlvbnMgPSB7XG4gICAgICAgICAgcGFnZVNpemVWYWw6IDUwMCxcbiAgICAgICAgICBwYWdlSW5kZXhWYWw6IDAsXG4gICAgICAgICAgaW5jbHVkZV9kb2NzOiB0cnVlXG4gICAgICAgIH1cblxuXG4gICAgICBkYW8uZ2V0RG9jVmlldyhkb2NJZCwgdmlld05hbWUsIG9wdGlvbnMpXG4gICAgICAgIC5kb25lKGZ1bmN0aW9uKGRhdGEpe1xuICAgICAgICAgIGRlZmZlcmVkLnJlc29sdmUoZGF0YSk7XG4gICAgICAgIH0pLmZhaWwoZnVuY3Rpb24oZXJyKXtcblxuXG4gICAgICAgICAgICB2YXIgVklFV19TRUFSQ0g9e1xuICAgICAgICAgICAgXCJsYW5ndWFnZVwiIDogXCJqYXZhc2NyaXB0XCIsXG4gICAgICAgICAgICAgIFwidmlld3NcIiA6IHtcbiAgICAgICAgICAgICAgICBcInZpZXdfc2VhcmNoRGF0YVwiIDoge1xuICAgICAgICAgICAgICAgICAgICAgIFwibWFwXCIgOiBcImZ1bmN0aW9uKGRvYykge1wiICtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBcImlmKHR5cGVvZiAoZG9jLnRpdGxlKSAhPSAndW5kZWZpbmVkJyBcIiArXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgXCImJiB0eXBlb2YgKGRvYy5jYXRlZ29yeSkgIT0gJ3VuZGVmaW5lZCcgXCIgK1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIFwiJiYgdHlwZW9mIChkb2MuY2F0ZWdvcnkudGVybSkgIT0gJ3VuZGVmaW5lZCcpe1wiICtcblxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIFwiaWYoIGRvYy5jYXRlZ29yeS50ZXJtID09ICdcIitjYXRlZ29yeStcIicgJiYgZG9jLmNoYW5uZWxzLmluZGV4T2YoJ1wiK3Byb2ZpbGVJZCtcIicpID4gLTEpIHtcIiArXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgXCIgIHZhciBqc29uT2JqID0ge1xcXCJkb2NcXFwiOiB7ICBcXFwidXBkYXRlZFxcXCI6IGRvYy51cGRhdGVkLCBcXFwiX2lkXFxcIjogZG9jLl9pZCwgXFxcInRpdGxlXFxcIjogZG9jLnRpdGxlLCBcXFwiY2F0ZWdvcnlcXFwiOiB7IFxcXCJ0ZXJtXFxcIjogZG9jLmNhdGVnb3J5LnRlcm0gfSwgXFxcIm1vZGVsXFxcIjogeyBcXFwicGVuZGluZ1xcXCI6IHsgXFxcInBob3Rvc1xcXCI6IFxcXCJcXFwiIH0gfSB9fTsgZW1pdChkb2MudGl0bGUudG9VcHBlckNhc2UoKSwgIGpzb25PYmogKTsgXCIgK1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgXCJ9XCIgK1xuXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgXCJ9XCIgK1xuICAgICAgICAgICAgICAgICAgICAgICAgICBcIn1cIlxuICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICB9XG4gICAgICAgICAgfTtcblxuXG4gICAgICAgIHZhciBzdWNjZXNzU2VhcmNoVmlldz1mdW5jdGlvbihkb2Mpe1xuXG5cbiAgICAgICAgICAgc2V0VGltZW91dChmdW5jdGlvbigpe1xuXG4gICAgICAgICAgICB2YXIgb3B0aW9ucyA9IHtcbiAgICAgICAgICAgICAgcGFnZVNpemVWYWw6IDUwMCxcbiAgICAgICAgICAgICAgcGFnZUluZGV4VmFsOiAwLFxuICAgICAgICAgICAgICBpbmNsdWRlX2RvY3M6IHRydWVcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgZGFvLmdldERvY1ZpZXcoZG9jSWQsIHZpZXdOYW1lLCBvcHRpb25zKVxuICAgICAgICAgICAgLmRvbmUoZnVuY3Rpb24oZGF0YSl7XG4gICAgICAgICAgICAgIGRlZmZlcmVkLnJlc29sdmUoZGF0YSk7XG4gICAgICAgICAgICB9KS5mYWlsKGZ1bmN0aW9uKGVycil7XG4gICAgICAgICAgICAgIGRlZmZlcmVkLnJlamVjdChlcnIpO1xuICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgfSwgMjAwMCk7XG5cbiAgICAgICAgfVxuXG5cbiAgICAgICAgZGFvLmNyZWF0ZURvY1ZpZXcoZG9jSWQsVklFV19TRUFSQ0gpXG4gICAgICAgIC5kb25lKHN1Y2Nlc3NTZWFyY2hWaWV3KVxuICAgICAgICAuZmFpbChmdW5jdGlvbihlcnIpe2RlZmZlcmVkLnJlamVjdChlcnIpO30pO1xuXG5cblxuXG4gICAgICAgIH0pO1xuXG5cblxuXG5cblxuICAgICAgcmV0dXJuIGRlZmZlcmVkO1xuXG5cbiAgICB9XG5cblxuXG5cbiAgfTtcblxufSkoKTtcbiJdfQ==
